import{d as e,r as t,a,o as l,c as s,w as c,b as i,e as n,f as o,F as r,g as u,i as d,S as f,n as p,h as _,t as y,j as m,k as v,l as g,m as k,s as w,p as h,q as b,u as L,v as x}from"./index-H1zobiUJ.js";import{r as z,_ as C,a as F}from"./uni-app.es.B9r4ma60.js";const j=F(e({__name:"NoticeSwiper",props:{noticeList:{default:()=>[]},autoplay:{type:Boolean,default:!0},interval:{default:5e3},vertical:{type:Boolean,default:!1}},emits:["click"],setup(e,{emit:g}){const k=g,w=t(0),h=e=>{w.value=e.detail.current};return(e,t)=>{const g=z(a("uni-icons"),C),b=d,L=m,x=v,F=f;return e.noticeList.length>0?(l(),s(b,{key:0,class:"notice-swiper-container"},{default:c((()=>[i(b,{class:"notice-swiper"},{default:c((()=>[i(F,{class:"swiper",autoplay:e.autoplay,interval:e.interval,circular:!0,vertical:e.vertical,"indicator-dots":!1,onChange:h},{default:c((()=>[(l(!0),n(r,null,o(e.noticeList,((e,t)=>(l(),s(x,{key:e._id||t},{default:c((()=>[i(b,{class:p(["swiper-item","type-"+e.type]),onClick:t=>(e=>{k("click",e)})(e)},{default:c((()=>[i(b,{class:"notice-icon"},{default:c((()=>{return[i(g,{type:(t=e.type,{promotion:"gift",announcement:"notification",maintenance:"gear"}[t]||"notification"),size:"20",color:"#ffffff"},null,8,["type"])];var t})),_:2},1024),i(b,{class:"notice-content"},{default:c((()=>[i(L,{class:"notice-title"},{default:c((()=>[_(y(e.title),1)])),_:2},1024),i(L,{class:"notice-desc"},{default:c((()=>{return[_(y((t=e.content,t?t.length>30?t.substring(0,30)+"...":t:"")),1)];var t})),_:2},1024)])),_:2},1024),i(b,{class:"notice-arrow"},{default:c((()=>[i(g,{type:"right",size:"18",color:"#ffffff"})])),_:1})])),_:2},1032,["class","onClick"])])),_:2},1024)))),128))])),_:1},8,["autoplay","interval","vertical"]),e.noticeList.length>1?(l(),s(b,{key:0,class:"indicator-dots"},{default:c((()=>[(l(!0),n(r,null,o(e.noticeList,((e,t)=>(l(),s(b,{key:t,class:p(["indicator-dot",{active:w.value===t}])},null,8,["class"])))),128))])),_:1})):u("",!0)])),_:1})])),_:1})):u("",!0)}}}),[["__scopeId","data-v-e86e4a78"]]),S=F(e({__name:"index",setup(e){const p=t([]),F=t([]),S=t([]),$=t(!1),A=async()=>{try{const e=await k.callFunction({name:"getNoticeList",data:{limit:5}});0===e.result.code&&(S.value=e.result.data.notices||[])}catch(e){console.error("获取通知列表失败:",e)}},B=async()=>{$.value=!0;try{const e=await k.callFunction({name:"getProductList",data:{page:1,pageSize:20}});if(0===e.result.code){const{products:t,banners:a}=e.result.data;F.value=t||[],p.value=a||[]}else w({title:e.result.message||"获取数据失败",icon:"none"})}catch(e){console.error("获取产品列表失败:",e),w({title:"网络错误，请重试",icon:"none"})}finally{$.value=!1}};g((()=>{A(),B()}));const I=e=>{const{linkType:t,linkUrl:a,_id:l}=e;switch(t){case"page":h({url:a,fail:()=>{b({url:a,fail:()=>{w({title:"页面跳转失败",icon:"none"})}})}});break;case"url":window.open(a,"_blank");break;case"product":h({url:`/pages/index/detail?id=${a}`,fail:()=>{w({title:"产品详情跳转失败",icon:"none"})}});break;default:h({url:`/pages/notice/detail?id=${l}`,fail:()=>{w({title:"通知详情跳转失败",icon:"none"})}})}},N=()=>{A(),B()};return(e,t)=>{const g=x,k=m,w=d,b=v,A=f,B=z(a("uni-icons"),C),q=L;return l(),s(w,{class:"container"},{default:c((()=>[i(j,{noticeList:S.value,onClick:I},null,8,["noticeList"]),p.value.length>0?(l(),s(w,{key:0,class:"swiper-section"},{default:c((()=>[i(A,{class:"swiper",circular:"",autoplay:"",interval:"3000"},{default:c((()=>[(l(!0),n(r,null,o(p.value,((e,t)=>(l(),s(b,{key:t},{default:c((()=>[i(w,{class:"swiper-item"},{default:c((()=>[i(g,{src:e.image,mode:"aspectFill"},null,8,["src"]),i(w,{class:"swiper-info"},{default:c((()=>[i(k,{class:"swiper-title"},{default:c((()=>[_(y(e.title),1)])),_:2},1024),i(k,{class:"swiper-desc"},{default:c((()=>[_(y(e.description),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128))])),_:1})])),_:1})):$.value?u("",!0):(l(),s(w,{key:1,class:"swiper-empty"},{default:c((()=>[i(w,{class:"empty-banner"},{default:c((()=>[i(B,{type:"image",size:"48",color:"#d9d9d9"}),i(k,{class:"empty-banner-text"},{default:c((()=>[_("暂无轮播内容")])),_:1})])),_:1})])),_:1})),i(w,{class:"recommend-section"},{default:c((()=>[i(w,{class:"section-header"},{default:c((()=>[i(k,{class:"section-title"},{default:c((()=>[_("热门推荐")])),_:1})])),_:1}),i(q,{class:"product-list","scroll-y":""},{default:c((()=>[(l(!0),n(r,null,o(F.value,((e,t)=>(l(),s(w,{key:t,class:"product-card",onClick:t=>{var a;h({url:`/pages/index/detail?id=${(a=e)._id||a.id}`})}},{default:c((()=>{return[i(g,{class:"product-image",src:(t=e.image,t?Array.isArray(t)?t.length>0?t[0]:"":"object"==typeof t&&t.url?t.url:t:""),mode:"aspectFill"},null,8,["src"]),i(w,{class:"product-info"},{default:c((()=>[i(k,{class:"product-name"},{default:c((()=>[_(y(e.name),1)])),_:2},1024),i(k,{class:"product-desc"},{default:c((()=>[_(y(e.description),1)])),_:2},1024),i(w,{class:"product-footer"},{default:c((()=>[i(w,{class:"difficulty"},{default:c((()=>[i(k,null,{default:c((()=>[_(y(e.difficulty),1)])),_:2},1024),i(B,{type:"star",size:"14",color:"#ff4757"})])),_:2},1024),i(k,{class:"rating"},{default:c((()=>[_(y(e.rating),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)];var t})),_:2},1032,["onClick"])))),128)),0!==F.value.length||$.value?u("",!0):(l(),s(w,{key:0,class:"product-empty"},{default:c((()=>[i(w,{class:"empty-content"},{default:c((()=>[i(B,{type:"shop",size:"64",color:"#d9d9d9"}),i(k,{class:"empty-title"},{default:c((()=>[_("暂无推荐产品")])),_:1}),i(k,{class:"empty-desc"},{default:c((()=>[_("当前没有可展示的产品信息")])),_:1}),i(w,{class:"empty-action",onClick:N},{default:c((()=>[i(k,{class:"action-text"},{default:c((()=>[_("重新加载")])),_:1})])),_:1})])),_:1})])),_:1})),$.value?(l(),s(w,{key:1,class:"loading-state"},{default:c((()=>[i(B,{type:"spinner-cycle",size:"32",color:"#999"}),i(k,{class:"loading-text"},{default:c((()=>[_("加载中...")])),_:1})])),_:1})):u("",!0)])),_:1})])),_:1})])),_:1})}}}),[["__scopeId","data-v-b4aa31cd"]]);export{S as default};

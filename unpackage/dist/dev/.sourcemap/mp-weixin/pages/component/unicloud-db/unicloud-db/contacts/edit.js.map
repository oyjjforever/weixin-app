{"version":3,"file":"edit.js","sources":["pages/component/unicloud-db/unicloud-db/contacts/edit.uvue","../../../Program Files/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvY29tcG9uZW50L3VuaWNsb3VkLWRiL3VuaWNsb3VkLWRiL2NvbnRhY3RzL2VkaXQudXZ1ZQ"],"sourcesContent":["<template>\r\n  <scroll-view class=\"scroll-view\">\r\n    <unicloud-db ref=\"udb\" v-slot:default=\"{data, loading, error}\" :collection=\"collection\" :where=\"where\"\r\n      page-data=\"replace\">\r\n      <view v-if=\"error!=null\" class=\"error\">{{error.errMsg}}</view>\r\n      <view v-if=\"loading\" class=\"loading\">正在加载...</view>\r\n      <form v-if=\"data.length>0\" @submit=\"onFormSubmit\">\r\n        <view class=\"form-item\">\r\n          <text class=\"form-item-label\">姓名</text>\r\n          <input class=\"form-item-input\" placeholder=\"姓名\" name=\"username\" :value=\"data[0].getString('username')\" />\r\n        </view>\r\n        <view class=\"form-item\">\r\n          <text class=\"form-item-label\">电话</text>\r\n          <input class=\"form-item-input\" placeholder=\"电话\" name=\"mobile\" :value=\"data[0].getString('mobile')\" />\r\n        </view>\r\n        <view class=\"form-item\">\r\n          <text class=\"form-item-label\">邮箱</text>\r\n          <input class=\"form-item-input\" placeholder=\"邮箱地址\" name=\"email\" :value=\"data[0].getString('email')\" />\r\n        </view>\r\n        <view class=\"form-item\">\r\n          <text class=\"form-item-label\">备注</text>\r\n          <textarea class=\"form-item-input-comment\" placeholder=\"备注\" name=\"comment\" maxlength=\"-1\"\r\n            :value=\"data[0].getString('comment')\" />\r\n        </view>\r\n        <view class=\"form-item\">\r\n          <text class=\"form-item-label\">性别</text>\r\n          <radio-group class=\"radio-list\" name=\"gender\">\r\n            <view class=\"radio-item\" v-for=\"(item, _) in genderList\" :key=\"item.value\">\r\n              <radio :value=\"item.value\" :checked=\"item.value == data[0].getNumber('gender')\" />\r\n              <text>{{item.text}}</text>\r\n            </view>\r\n          </radio-group>\r\n        </view>\r\n        <view class=\"btn-group\">\r\n          <button class=\"btn-submit\" type=\"primary\" form-type=\"submit\">保存</button>\r\n          <button class=\"btn-delete\" type=\"warn\"\r\n            @click=\"remove(data[0].getString('_id'), data[0].getString('username'))\">删除联系人</button>\r\n        </view>\r\n      </form>\r\n    </unicloud-db>\r\n  </scroll-view>\r\n</template>\r\n\r\n<script lang=\"uts\">\r\n  import { COLLECTION_NAME, GenderType, GenderList, UNICLOUD_DB_CONTACTS_UPDATE, UNICLOUD_DB_CONTACTS_DELETE } from './types.uts'\r\n\r\n  export default {\r\n    data() {\r\n      return {\r\n        collection: '',\r\n        where: '',\r\n        genderList: GenderList as GenderType[],\r\n        whereID: '',\r\n        uniCloudElement: null as UniCloudDBElement | null\r\n      }\r\n    },\r\n    onLoad(options) {\r\n      this.collection = COLLECTION_NAME;\r\n      this.whereID = options['id'] as string;\r\n      this.where = `_id=='${this.whereID}'`;\r\n    },\r\n    onReady() {\r\n      this.uniCloudElement = this.$refs['udb'] as UniCloudDBElement\r\n    },\r\n    methods: {\r\n      onFormSubmit: function (e : UniFormSubmitEvent) {\r\n        const formData = e.detail.value\r\n        const genderString = formData['gender'] as string\r\n        formData['gender'] = (genderString.length > 0) ? parseInt(genderString) : -1\r\n        this.uniCloudElement!.update(this.whereID, formData, {\r\n          showToast: false,\r\n          needLoading: true,\r\n          needConfirm: false,\r\n          loadingTitle: \"正在保存...\",\r\n          success: (_ : UniCloudDBUpdateResult) => {\r\n            // TODO 后续通过 EventChannel 实现\r\n            uni.$emit(UNICLOUD_DB_CONTACTS_UPDATE, this.whereID)\r\n            setTimeout(() => {\r\n              uni.navigateBack()\r\n            }, 500)\r\n          },\r\n          fail: (err : any | null) => {\r\n            const error = err as UniCloudError\r\n            uni.showModal({\r\n              content: error.errMsg,\r\n              showCancel: false\r\n            })\r\n          }\r\n        })\r\n      },\r\n      remove(id : string | null, name : string | null) {\r\n        this.uniCloudElement!.remove(id!, {\r\n          needConfirm: true,\r\n          needLoading: true,\r\n          loadingTitle: \"正在删除...\",\r\n          confirmTitle: \"确定删除?\",\r\n          confirmContent: name,\r\n          success: (_ : UniCloudDBRemoveResult) => {\r\n            // TODO 后续通过 EventChannel 实现\r\n            uni.$emit(UNICLOUD_DB_CONTACTS_DELETE, this.whereID)\r\n            setTimeout(() => {\r\n              uni.navigateBack({\r\n                delta: 2\r\n              })\r\n            }, 500)\r\n          },\r\n          fail: (err : any | null) => {\r\n            const error = err as UniCloudError\r\n            uni.showModal({\r\n              content: error.errMsg,\r\n              showCancel: false\r\n            })\r\n          }\r\n        })\r\n      }\r\n    }\r\n  }\r\n</script>\r\n\r\n<style>\r\n  .page {\r\n    flex: 1;\r\n  }\r\n\r\n  .scroll-view {\r\n    padding: 15px;\r\n    flex: 1;\r\n  }\r\n\r\n  .loading {\r\n    align-items: center;\r\n  }\r\n\r\n  .form-item {\r\n    flex-direction: row;\r\n    margin-bottom: 15px;\r\n    align-items: center;\r\n  }\r\n\r\n  .form-item-label {\r\n    width: 45px;\r\n    margin-right: 10px;\r\n  }\r\n\r\n  .form-item-input {\n    flex: 1;\n    font-size: 14px;\n    color: #666;\n    border: 1px #e5e5e5 solid;\n    border-radius: 5px;\n    height: 34px;\n    padding-left: 8px;\n    padding-right: 8px;\n  }\n\n  .form-item-input-comment {\n    flex: 1;\n    font-size: 14px;\n    color: #666;\n    border: 1px #e5e5e5 solid;\n    border-radius: 5px;\n    padding: 8px;\n  }\r\n\r\n  .radio-list {\r\n    flex-direction: row;\r\n  }\r\n\r\n  .radio-item {\r\n    flex-direction: row;\r\n    margin-right: 30px;\r\n    align-items: center;\r\n  }\r\n\r\n  .btn-group {\r\n    margin-top: 30px;\r\n  }\r\n\r\n  .btn-delete {\r\n    margin-top: 15px;\r\n  }\r\n</style>\n","import MiniProgramPage from 'W:/Workplace/2.小程序/lihai-app/pages/component/unicloud-db/unicloud-db/contacts/edit.uvue'\nwx.createPage(MiniProgramPage)"],"names":["defineComponent","GenderList","COLLECTION_NAME","uni","UNICLOUD_DB_CONTACTS_UPDATE","UNICLOUD_DB_CONTACTS_DELETE"],"mappings":";;;AA8CE,MAAA,YAAeA,8BAAA;AAAA,EACb,OAAI;AACF,WAAO;AAAA,MACL,YAAY;AAAA,MACZ,OAAO;AAAA,MACP,YAAYC,qDAA0B;AAAA,MACtC,SAAS;AAAA,MACT,iBAAiB;AAAA;EAEpB;AAAA,EACD,OAAO,SAAO;AACZ,SAAK,aAAaC;AAClB,SAAK,UAAU,QAAQ,IAAI;AAC3B,SAAK,QAAQ,SAAS,KAAK,OAAO;AAAA,EACnC;AAAA,EACD,UAAO;AACL,SAAK,kBAAkB,KAAK,MAAM,KAAK;AAAA,EACxC;AAAA,EACD,SAAS;AAAA,IACP,cAAc,SAAU,GAAsB;AAC5C,YAAM,WAAW,EAAE,OAAO;AAC1B,YAAM,eAAe,SAAS,QAAQ;AACtC,eAAS,QAAQ,IAAK,aAAa,SAAS,IAAK,SAAS,YAAY,IAAI;AAC1E,WAAK,gBAAiB,OAAO,KAAK,SAAS,UAAU,IAAA,cAAA;AAAA,QACnD,WAAW;AAAA,QACX,aAAa;AAAA,QACb,aAAa;AAAA,QACb,cAAc;AAAA,QACd,SAAS,CAAC,MAA0B;AAElCC,wBAAAA,MAAI,MAAMC,qDAAAA,6BAA6B,KAAK,OAAO;AACnD,qBAAW,MAAA;AACTD,0BAAG,MAAC,aAAY;AAAA,UACjB,GAAE,GAAG;AAAA,QACP;AAAA,QACD,MAAM,CAAC,MAAgB,SAAA;AACrB,gBAAM,QAAQ;AACdA,8BAAI,UAAU,IAAA,cAAA;AAAA,YACZ,SAAS,MAAM;AAAA,YACf,YAAY;AAAA,UACb,CAAA,CAAA;AAAA,QACH;AAAA,MACD,CAAA,CAAA;AAAA,IACF;AAAA,IACD,OAAO,KAAkB,MAAE,OAAoB,MAAA;AAC7C,WAAK,gBAAiB,OAAO,IAAK,IAAA,cAAA;AAAA,QAChC,aAAa;AAAA,QACb,aAAa;AAAA,QACb,cAAc;AAAA,QACd,cAAc;AAAA,QACd,gBAAgB;AAAA,QAChB,SAAS,CAAC,MAA0B;AAElCA,wBAAAA,MAAI,MAAME,qDAAAA,6BAA6B,KAAK,OAAO;AACnD,qBAAW,MAAA;AACTF,gCAAI,aAAa,IAAA,cAAA;AAAA,cACf,OAAO;AAAA,YACR,CAAA,CAAA;AAAA,UACF,GAAE,GAAG;AAAA,QACP;AAAA,QACD,MAAM,CAAC,MAAgB,SAAA;AACrB,gBAAM,QAAQ;AACdA,8BAAI,UAAU,IAAA,cAAA;AAAA,YACZ,SAAS,MAAM;AAAA,YACf,YAAY;AAAA,UACb,CAAA,CAAA;AAAA,QACH;AAAA,MACD,CAAA,CAAA;AAAA,IACH;AAAA,EACF;CACF;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACnHF,GAAG,WAAW,eAAe;"}
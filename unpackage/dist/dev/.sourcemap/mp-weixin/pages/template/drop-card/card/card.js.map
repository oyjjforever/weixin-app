{"version":3,"file":"card.js","sources":["pages/template/drop-card/card/card.uvue","../../../Program Files/HBuilderX/plugins/uniapp-cli-vite/uniComponent:/VzovV29ya3BsYWNlLzIu5bCP56iL5bqPL2xpaGFpLWFwcC9wYWdlcy90ZW1wbGF0ZS9kcm9wLWNhcmQvY2FyZC9jYXJkLnV2dWU"],"sourcesContent":["<template>\n  <view class=\"card\" ref=\"card\" @touchstart=\"touchstart($event as TouchEvent)\"\n    @touchmove=\"touchmove($event as TouchEvent)\" @touchend=\"touchend\" @touchcancel=\"touchend\">\n    <image class=\"card-img\" ref=\"card-img\" :src=\"img\"></image>\n    <view class=\"state\">\n      <image class=\"state-icon like\" ref=\"state-icon-like\" src=\"/static/template/drop-card/like.png\" mode=\"widthFix\">\n      </image>\n      <image class=\"state-icon dislike\" ref=\"state-icon-dislike\" src=\"/static/template/drop-card/dislike.png\"\n        mode=\"widthFix\"></image>\n      <!-- cardIndex:{{cardIndex}} -->\n    </view>\n  </view>\n</template>\n<script lang=\"uts\">\n  let sX : number = 0,\n    sY : number = 0,\n    screenWidth : number = 1,\n    screenHeight : number = 1,\n    floating : boolean = false,\n    touchstartAfter : boolean = false;\n  export default {\n    options: {\n      virtualHost: true\n    },\n    data() {\n      return {\n        $elementMap: new Map<string, UniElement>(),\n        x: 0 as number,\n        y: 0 as number,\n        // 飘走的卡片计数\n        floatCount: 0 as number\n      }\n    },\n    props: {\n      img: {\n        type: String,\n        default: \"https://web-ext-storage.dcloud.net.cn/hello-uni-app-x/drop-card-1.jpg\"\n      },\n      cardIndex: {\n        type: Number,\n        default: 0\n      }\n    },\n    computed: {\n      movePercent() : number {\n        return Math.abs(this.x) / (screenWidth / 2 * 3)\n      },\n      likeOpacity() : number {\n        return this.x < 0 ? 0 : this.movePercent * 100\n      },\n      dislikeOpacity() : number {\n        return this.x > 0 ? 0 : this.movePercent * 100\n      }\n    },\n    mounted() {\n      screenWidth = uni.getWindowInfo().screenWidth\n      screenHeight = uni.getWindowInfo().screenHeight;\n\n      // TODO 需要延迟设置才能生效\n      setTimeout(() => {\n        this.setElementStyle('card', 'height', screenHeight * 0.7 + 'px');\n        this.setElementStyle('card-img', 'height', screenHeight * 0.7 + 'px');\n        this.initCardStyle()\n      }, 200)\n\n      uni.$on('uni-drop-card-float', () => {\n        this.floatCount++\n        this.initCardStyle()\n      })\n\n    },\n    unmounted() {\n      uni.$off('uni-drop-card-float')\n    },\n    methods: {\n      initCardStyle() {\n        let _index = (this.cardIndex + this.floatCount) % 3\n        // uni.__f__('log','at pages/template/drop-card/card/card.uvue:78','~~~~~~_index:'+_index + ' cardIndex:'+this.cardIndex+' floatCount:'+this.floatCount);\n        this.setElementStyle('card', 'z-index', _index)\n        this.setElementStyle('card', 'margin-top', screenHeight * 0.15 - 30 * _index + 'px');\n        this.setElementStyle('card', 'transform', 'scale(' + (0.9 + 0.05 * _index) + ')')\n      },\n      // 工具方法，用于快速设置 Element 的 style\n      setElementStyle(refName : string, propertyName : string, propertyStyle : any) : void {\n        const elementMap = this.$data['$elementMap'] as Map<string, UniElement>\n        let element : UniElement | null = elementMap.get(refName)\n        if (element == null) {\n          element = this.$refs[refName] as UniElement;\n          elementMap.set(refName, element)\n        } else {\n          // uni.__f__('log','at pages/template/drop-card/card/card.uvue:91','直接拿');\n        }\n        element.style.setProperty(propertyName, propertyStyle);\n      },\n      touchstart(e : TouchEvent) {\n        // uni.__f__('log','at pages/template/drop-card/card/card.uvue:96','touchstart')\n        if (floating) {\n          return // 浮动动画进行中\n        }\n        sX = e.touches[0].screenX;\n        sY = e.touches[0].screenY;\n        this.x = 0\n        this.y = 0\n\n        touchstartAfter = true\n      },\n      touchmove(e : TouchEvent) {\n        // uni.__f__('log','at pages/template/drop-card/card/card.uvue:108','touchmove')\n        if (!touchstartAfter || floating) {\n          return // floating：浮动动画进行中\n        }\n        this.x += e.touches[0].screenX - sX;\n        this.y += e.touches[0].screenY - sY;\n        sX = e.touches[0].screenX;\n        sY = e.touches[0].screenY;\n        this.moveCard()\n\n\n\n\n      },\n      touchend() {\n        // uni.__f__('log','at pages/template/drop-card/card/card.uvue:123','touchend')\n        touchstartAfter = false\n        if (floating) {\n          return // 浮动动画进行中\n        }\n        floating = true\n\n        // 设置释放之后飘走的方向 0回到坐标中心 1向右 2向左\n        let k : number = 0;\n        if (this.x > screenWidth / 10) {\n          k = 1\n        } else if (this.x < screenWidth * -1 / 10) {\n          k = -1\n        }\n\n        const _this = this\n        function cardTo(x : number, y : number, callback : () => void, speed : number = 10) {\n          let interval : number = 0\n          let acceleration : number = 1\n          interval = setInterval(() => {\n            // 加速度\n            acceleration += 0.2\n\n            const dx = x - _this.x\n            if (Math.abs(dx) < 1) {\n              _this.x = x\n            } else {\n              _this.x += dx / speed * acceleration\n            }\n\n            const dy = y - _this.y\n            if (Math.abs(dy) < 1) {\n              _this.y = y\n            } else {\n              _this.y += dy / speed * acceleration\n            }\n\n            _this.moveCard()\n            if (_this.x == x && _this.y == y) {\n              clearInterval(interval)\n              callback()\n            }\n          }, 16)\n        }\n\n        if (Math.floor(k) != 0) {\n          cardTo(k * screenWidth * 1.3, this.y * 3, () => {\n            //  状态图标变回透明\n            this.setElementStyle(\"state-icon-like\", 'opacity', 0)\n            this.setElementStyle(\"state-icon-dislike\", 'opacity', 0)\n\n            // 设置为透明，防止飘回时因为 margin-top 太高，露出来\n            this.setElementStyle(\"card\", 'opacity', 0)\n            setTimeout(() => {\n              this.setElementStyle(\"card\", 'opacity', 1)\n            }, 300)\n\n            // 执行卡片飘动后事件，注意uni.$emit是全局事件。其他卡片也会执行\n            uni.$emit('uni-drop-card-float', null)\n            floating = false\n          }, 8)\n        } else {\n          const _x : number = this.x\n          const _y : number = this.y\n          cardTo(Math.floor(_x * -0.05), Math.floor(_y * -0.05), () => {\n            cardTo(0, 0, () => {\n              uni.__f__('log','at pages/template/drop-card/card/card.uvue:189','bounce')\n              floating = false\n            }, 30)\n          })\n        }\n      },\n      moveCard() {\n        this.setElementStyle(\"card\",\n          'transform',\n          `translate(${this.x}px,${this.y}px) rotate(${this.x / -30}deg) scale(1)`\n        )\n        this.setElementStyle(\"state-icon-like\", 'opacity', this.x < 0 ? 0 : this.movePercent * 10)\n        this.setElementStyle(\"state-icon-dislike\", 'opacity', this.x > 0 ? 0 : this.movePercent * 10)\n      }\n    }\n  }\n</script>\n\n<style>\n  .card {\n    width:95%;\n    height: 0px;\n    position: absolute;\n    top: 0px;\n    /* left: 0px; */\n    margin: 0 12px;\n    margin-top: 50px;\n    border-radius: 10px;\n    box-shadow: 0 0 5px rgba(0, 0, 0, 0.1);\n    background-color: #FFF;\n    transition: margin-top 300ms;\n    transition-timing-function: ease-in;\n  }\n\n  .card-img {\n    width: 100%;\n    height: 0px;\n    border-radius: 10px;\n  }\n\n  .state {\n    top: 10px;\n    left: 10px;\n    width: 86%;\n    padding: 4px;\n    position: absolute;\n    flex-direction: row;\n    justify-content: space-between;\n  }\n\n  .state-icon {\n    width: 30px;\n    height: 30px;\n    border: 1px solid #FFF;\n    background-color: #FFF;\n    padding: 3px;\n    border-radius: 100px;\n    box-shadow: 0 0 1px #EBEBEB;\n    opacity: 0;\n  }\n</style>\n","import Component from 'W:/Workplace/2.小程序/lihai-app/pages/template/drop-card/card/card.uvue'\nwx.createComponent(Component)"],"names":["defineComponent","uni"],"mappings":"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"}
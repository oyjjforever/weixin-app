{"version":3,"file":"long-list-page.js","sources":["pages/template/long-list/long-list-page.uvue","../../../Program Files/HBuilderX/plugins/uniapp-cli-vite/uniComponent:/VzovV29ya3BsYWNlLzIu5bCP56iL5bqPL2xpaGFpLWFwcC9wYWdlcy90ZW1wbGF0ZS9sb25nLWxpc3QvbG9uZy1saXN0LXBhZ2UudXZ1ZQ"],"sourcesContent":["<template>\n  <list-view :id=\"id\" class=\"list\" :bounces=\"false\" :scroll-y=\"true\" :custom-nested-scroll=\"true\"\n    @scrolltolower=\"loadData(null)\" associative-container=\"nested-scroll-view\">\n    <list-item class=\"list-item\" v-for=\"(item, _) in dataList\" :key=\"item.plugin_id\" type=\"10\">\n      <view class=\"list-item-icon\">\n        <image class=\"list-item-icon-image\" :src=\"item.plugin_img_link\"></image>\n      </view>\n      <view class=\"list-item-fill\">\n        <view class=\"flex-row\">\n          <text class=\"title\">{{item.plugin_name}}</text>\n        </view>\n        <view>\n          <text class=\"description-text\">{{item.plugin_intro}}</text>\n        </view>\n        <text class=\"icon-star\">{{convertToStarUnicode(item.score)}}</text>\n        <view class=\"tag-list\">\n          <text class=\"tag-item\" v-for=\"(item2, index2) in item.tags\" :key=\"index2\">{{item2}}</text>\n        </view>\n        <view class=\"flex-row update-date\">\n          <text class=\"update-date-text\">更新日期</text>\n          <text class=\"update-date-value\">{{item.update_date}}</text>\n          <text class=\"author\">{{item.author_name}}</text>\n        </view>\n      </view>\n    </list-item type=\"20\">\n    <list-item class=\"loading\">\n      <uni-loading :loading=\"loading\" color=\"#999\" :text=\"loadingText\"></uni-loading>\n    </list-item>\n  </list-view>\n</template>\n\n<script setup lang=\"uts\">\nconst SERVER_URL = \"https://unidemo.dcloud.net.cn/plugin/uniappx-plugin-list\"\nconst PAGE_SIZE = 10\n\ntype ListItem = {\n  plugin_id : number,\n  plugin_img_link : string,\n  plugin_name : string,\n  plugin_intro : string,\n  score : number,\n  tags : Array<string>,\n  update_date : string,\n  author_name : string,\n}\n\ntype ResponseDataType = {\n  code : number,\n  data : ListItem[]\n}\n\nconst props = defineProps({\n  type: { type: String, default: '' },\n  preload: { type: Boolean, default: false },\n  id: { type: String, default: '' }\n})\n\nconst loading = ref(false)\nconst dataList = ref<ListItem[]>([])\nconst isEnded = ref(false)\nconst loadingError = ref('')\nconst currentPage = ref(1)\n\nconst loadingText = computed((): string => {\n  if (loading.value) {\n    return \"加载中...\"\n  } else if (isEnded.value) {\n    return \"没有更多了\"\n  } else if (loadingError.value.length > 0) {\n    return loadingError.value\n  } else {\n    return \"\"\n  }\n})\n\nfunction convertToStarUnicode(score : number) : string {\n  const fill_code = '\\ue879'\n  const half_code = '\\ue87a'\n  const null_code = '\\ue87b'\n\n  const fillStarCount = parseInt(score / 10 % 10 + '')\n  const halfStarCount = score % 10 >= 5 ? 1 : 0\n  const nullStarCount = 5 - fillStarCount - halfStarCount\n\n  let result = ''\n  if (fillStarCount > 0) { result += fill_code.repeat(fillStarCount) }\n  if (halfStarCount > 0) { result += half_code.repeat(halfStarCount) }\n  if (nullStarCount > 0) { result += null_code.repeat(nullStarCount) }\n\n  return result\n}\n\nfunction loadData(loadComplete : (() => void) | null) {\n  if (loading.value || isEnded.value) {\n    return\n  }\n  loading.value = true\n\n  uni.request<ResponseDataType>({\n    url: SERVER_URL,\n    data: {\n      type: props.type,\n      page: currentPage.value,\n      page_size: PAGE_SIZE\n    },\n    success: (res) => {\n      const responseData = res.data\n      // uni.__f__('log','at pages/template/long-list/long-list-page.uvue:108','responseData',responseData)\n      if (responseData == null) {\n        return\n      }\n      dataList.value.push(...responseData.data)\n      if (responseData.data.length == 0) {\n        isEnded.value = true\n      } else {\n        currentPage.value++\n      }\n    },\n    fail: (err) => {\n      loadingError.value = err.errMsg\n    },\n    complete: () => {\n      loading.value = false\n      if (loadComplete != null) {\n        loadComplete()\n      }\n    }\n  })\n}\n\nfunction refreshData(loadComplete : (() => void) | null) {\n  dataList.value.length = 0\n  currentPage.value = 1\n  loadData(loadComplete)\n}\n\nonMounted(() => {\n  if (props.preload) {\n    loadData(null)\n  }\n})\n\ndefineExpose({\n  loadData,\n  refreshData\n})\n</script>\n\n<style>\n  @font-face {\n    font-family: \"UtsStarIcons\";\n    src: url('@/static/fonts/icon-star.ttf');\n  }\n\n  .list {\n    flex: 1;\n    background-color: #ffffff;\n  }\n\n  .list-item {\n    flex-direction: row;\n    margin-top: 10px;\n    padding: 10px;\n  }\n\n  .list-item-icon {\n    position: relative;\n  }\n\n  .list-item-icon-image {\n    width: 80px;\n    height: 80px;\n  }\n\n  .list-item-fill {\n    flex: 1;\n    margin-left: 15px;\n  }\n\n  .description-text {\n    font-size: 13px;\n    color: #666;\n    line-height: 19px;\n  }\n\n  .icon-star {\n    font-family: \"UtsStarIcons\";\n    font-size: 16px;\n    font-style: normal;\n    color: #ffca3e;\n    letter-spacing: 3px;\n  }\n\n  .tag-list {\n    flex-direction: row;\n    margin-top: 5px;\n  }\n\n  .tag-item {\n    font-size: 12px;\n    background-color: #EFF9F0;\n    color: #639069;\n    border-radius: 20px;\n    margin-right: 5px;\n    padding: 2px 5px;\n  }\n\n  .update-date {\n    margin-top: 10px;\n  }\n\n  .update-date-text {\n    font-size: 12px;\n    color: #888888;\n  }\n\n  .update-date-value {\n    font-size: 12px;\n    color: #777777;\n    margin-left: 5px;\n  }\n\n  .author {\n    font-size: 12px;\n    color: #008000;\n    margin-left: auto;\n  }\n\n  .loading {\n    padding: 30px;\n    align-items: center;\n  }\n\n  .flex-row {\n    flex-direction: row;\n  }\n</style>\n","import Component from 'W:/Workplace/2.小程序/lihai-app/pages/template/long-list/long-list-page.uvue'\nwx.createComponent(Component)"],"names":["ref","computed","uni","onMounted","Component"],"mappings":";;;;;;;;;;AAgCA,MAAM,aAAa;AACnB,MAAM,YAAY;MAEb,iBAAQ,IAAA,QAAA;AAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;MAWR,yBAAgB,IAAA,QAAA;AAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAKrB,UAAM,QAAQ;AAMd,UAAM,UAAUA,kBAAI,KAAK;AACzB,UAAM,WAAWA,kBAAgB,CAAA,CAAE;AACnC,UAAM,UAAUA,kBAAI,KAAK;AACzB,UAAM,eAAeA,kBAAI,EAAE;AAC3B,UAAM,cAAcA,kBAAI,CAAC;AAEzB,UAAM,cAAcC,cAAAA,SAAS,MAAA;AAC3B,UAAI,QAAQ,OAAO;AACjB,eAAO;AAAA,MACR,WAAU,QAAQ,OAAO;AACxB,eAAO;AAAA,MACR,WAAU,aAAa,MAAM,SAAS,GAAG;AACxC,eAAO,aAAa;AAAA,MACrB,OAAM;AACL,eAAO;AAAA,MACR;AAAA,IACH,CAAC;AAED,aAAS,qBAAqB,OAAc;AAC1C,YAAM,YAAY;AAClB,YAAM,YAAY;AAClB,YAAM,YAAY;AAElB,YAAM,gBAAgB,SAAS,QAAQ,KAAK,KAAK,EAAE;AACnD,YAAM,gBAAgB,QAAQ,MAAM,IAAI,IAAI;AAC5C,YAAM,gBAAgB,IAAI,gBAAgB;AAE1C,UAAI,SAAS;AACb,UAAI,gBAAgB,GAAG;AAAE,kBAAU,UAAU,OAAO,aAAa;AAAA,MAAG;AACpE,UAAI,gBAAgB,GAAG;AAAE,kBAAU,UAAU,OAAO,aAAa;AAAA,MAAG;AACpE,UAAI,gBAAgB,GAAG;AAAE,kBAAU,UAAU,OAAO,aAAa;AAAA,MAAG;AAEpE,aAAO;AAAA,IACT;AAEA,aAAS,SAAS,eAAkC,MAAA;AAClD,UAAI,QAAQ,SAAS,QAAQ,OAAO;AAClC,eAAM;AAAA,MACP;AACD,cAAQ,QAAQ;AAEhBC,oBAAAA,MAAI,QAA0B;AAAA,QAC5B,KAAK;AAAA,QACL,MAAM,IAAA,cAAA;AAAA,UACJ,MAAM,MAAM;AAAA,UACZ,MAAM,YAAY;AAAA,UAClB,WAAW;AAAA,SACZ;AAAA,QACD,SAAS,CAAC,QAAG;AACX,gBAAM,eAAe,IAAI;AAEzB,cAAI,gBAAgB,MAAM;AACxB,mBAAM;AAAA,UACP;AACD,mBAAS,MAAM,KAAK,GAAG,aAAa,IAAI;AACxC,cAAI,aAAa,KAAK,UAAU,GAAG;AACjC,oBAAQ,QAAQ;AAAA,UACjB,OAAM;AACL,wBAAY;AAAA,UACb;AAAA,QACF;AAAA,QACD,MAAM,CAAC,QAAG;AACR,uBAAa,QAAQ,IAAI;AAAA,QAC1B;AAAA,QACD,UAAU,MAAA;AACR,kBAAQ,QAAQ;AAChB,cAAI,gBAAgB,MAAM;AACxB;UACD;AAAA,QACH;AAAA,MACD,GAAA,gBAAA;AAAA,IACH;AAEA,aAAS,YAAY,eAAkC,MAAA;AACrD,eAAS,MAAM,SAAS;AACxB,kBAAY,QAAQ;AACpB,eAAS,YAAY;AAAA,IACvB;AAEAC,kBAAAA,UAAU,MAAA;AACR,UAAI,MAAM,SAAS;AACjB,iBAAS,IAAI;AAAA,MACd;AAAA,IACH,CAAC;AAED,aAAa,IAAA,cAAA;AAAA,MACX;AAAA,MACA;AAAA,IACD,CAAA,CAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AChJD,GAAG,gBAAgBC,SAAS;"}
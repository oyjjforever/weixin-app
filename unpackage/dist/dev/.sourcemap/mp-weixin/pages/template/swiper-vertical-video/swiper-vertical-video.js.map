{"version":3,"file":"swiper-vertical-video.js","sources":["pages/template/swiper-vertical-video/swiper-vertical-video.uvue","../../../Program Files/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXNcdGVtcGxhdGVcc3dpcGVyLXZlcnRpY2FsLXZpZGVvXHN3aXBlci12ZXJ0aWNhbC12aWRlby51dnVl"],"sourcesContent":["<template>\r\n  <view class=\"page\">\r\n    <view ref=\"back\" @click=\"back\" class=\"nav-back\">\r\n      <image class=\"back-img\" src=\"/static/template/scroll-fold-nav/back.png\" mode=\"widthFix\"></image>\r\n    </view>\r\n    <swiper class=\"swiper\" :current=\"current\" :circular=\"index != 0\" :vertical=\"true\" @change=\"onSwiperChange\"\r\n      @transition=\"onTransition\">\r\n      <swiper-item class=\"swiper-item\" v-for=\"(item,i) in visibleList\" :key=\"i\">\r\n        <video @click=\"changeState(i)\" ref=\"video\" class=\"video-box\" :id=\"'video-'+i\"\r\n          @loadstart=\"onLoadstart(i)\" :src=\"item.src\" :poster=\"item.poster_src\" :autoplay=\"false\"\r\n          :show-progress=\"false\" :show-fullscreen-btn=\"false\" :show-play-btn=\"false\"\r\n          :show-center-play-btn=\"false\" :loop=\"true\" @play=\"onPlay(i)\" @pause=\"onPause(i)\" http-cache=\"true\"></video>\r\n        <view class=\"video-cover\" @click=\"changeState(i)\">\r\n          <image v-if=\"state[i] === 'pause'\" class=\"play-btn\" src=\"/static/template/swiper-vertical-video/play.png\"\r\n            mode=\"widthFix\"></image>\r\n        </view>\r\n        <view class=\"video-info\" v-if=\"showDebugInfo\">\r\n          <text class=\"video-info-text\">容器：第 {{i}} 个</text>\r\n          <text class=\"video-info-text\">内容：{{item.content}}</text>\r\n        </view>\r\n      </swiper-item>\r\n    </swiper>\r\n    <view class=\"debug-info\" v-if=\"showDebugInfo\">\r\n      <text class=\"status-text\">debug-info 播放状态:</text>\r\n      <text class=\"status-text\" v-for=\"(value,index) in state\">第{{index+1}}个:{{ value }}</text>\r\n    </view>\r\n  </view>\r\n</template>\r\n<script lang=\"uts\">\r\n  type ListItem = { _id : string, content : string, src : string, poster_src : string }\r\n  let page : number = 0,\r\n    currentPageIsShow : boolean = true;\r\n\r\n  import { state, setNetless } from '@/store/index.uts'\r\n  export default {\r\n    components: {},\r\n    data() {\r\n      return {\r\n        $videoContextMap: new Map<string, VideoContext>(),\r\n        list: [] as ListItem[],\r\n        visibleList: [] as ListItem[],// 提高性能 可见的只有3个\r\n        current: 0 as number,\r\n        index: 0,\r\n        state: [\"pause\", \"unPlay\", \"unPlay\"] as string[],\r\n        showDebugInfo: false as boolean\r\n      }\r\n    },\r\n    created() {\r\n\r\n\r\n\r\n\r\n\r\n          this.list = this.getData()\r\n          this.visibleList = this.list.slice(0, 3)\r\n\r\n\r\n\r\n\r\n    },\r\n    watch: {\r\n      current(current : number, oldCurrent : number) {\r\n        let changeNumber = current - oldCurrent\r\n        if (changeNumber == 1 || changeNumber == -2) {\r\n          // uni.__f__('error','at pages/template/swiper-vertical-video/swiper-vertical-video.uvue:65','向右');\r\n          this.index++\r\n        } else {\r\n          // uni.__f__('error','at pages/template/swiper-vertical-video/swiper-vertical-video.uvue:68','向左');\r\n          this.index--\r\n        }\r\n        // //翻页（3项为一页）\r\n        if (Math.abs(changeNumber) == 2) {\r\n          // uni.__f__('log','at pages/template/swiper-vertical-video/swiper-vertical-video.uvue:73','翻页');\r\n          page = Math.floor(this.index / 3);\r\n          // uni.__f__('log','at pages/template/swiper-vertical-video/swiper-vertical-video.uvue:75',this.index);\r\n          // uni.__f__('log','at pages/template/swiper-vertical-video/swiper-vertical-video.uvue:76','page',page);\r\n          // uni.__f__('log','at pages/template/swiper-vertical-video/swiper-vertical-video.uvue:77','slice',3*page,3*page+3);\r\n          if (this.list.length < 3 * page + 3) {\r\n            let list : ListItem[] = this.getData()\r\n            this.list.push(...list)\r\n          }\r\n\r\n          let visibleList = this.list.slice(3 * page, 3 * page + 3)\r\n          // 换数据\r\n          this.visibleList = visibleList\r\n        }\r\n\r\n        this.state.forEach((_ : string, index : number) => {\r\n          if (index === current) {\r\n            this.doPlay(current)\r\n          } else {\r\n            // 除了选中的其他已经播放的都需要停止\r\n            this.doStop(index)\r\n            uni.__f__('log','at pages/template/swiper-vertical-video/swiper-vertical-video.uvue:94','index:' + index + '已被执行停止');\r\n          }\r\n        })\r\n      }\r\n    },\r\n    onReady() {\r\n\r\n      //  非web端，一启动完成，就播放第一个。因为 web端浏览器限制不支持自动播放\r\n      this.doPlay(0);\r\n      //App端适配不同状态栏高度\r\n      let backElement = this.$refs['back'] as UniElement;\r\n      backElement.style.setProperty('top', uni.getWindowInfo().statusBarHeight+'px');\r\n\r\n    },\r\n    onShow() {\r\n      currentPageIsShow = true\r\n    },\r\n    onHide() {\r\n      currentPageIsShow = false\r\n      uni.__f__('log','at pages/template/swiper-vertical-video/swiper-vertical-video.uvue:113','pages-onHide');\r\n      this.doPause(this.current)\r\n    },\r\n    onUnload() {\r\n      this.doPause(this.current)\r\n    },\r\n    methods: {\r\n      changeState(index : number) {\r\n        if (this.state[index] === 'play') {\r\n          this.doPause(index)\r\n        } else {\r\n          this.doPlay(this.current)\r\n        }\r\n      },\r\n      onLoadstart(index : number) {\r\n        uni.__f__('error','at pages/template/swiper-vertical-video/swiper-vertical-video.uvue:128',\"onLoadstart  video\" + index);\r\n      },\r\n      getVideoContext(index : number) : VideoContext {\r\n        const videoContextMap = this.$data['$videoContextMap'] as Map<string, VideoContext>\r\n        let videoContext : VideoContext | null = videoContextMap.get('video-' + index)\r\n        if (videoContext == null) {\r\n          videoContext = uni.createVideoContext('video-' + index, this) as VideoContext\r\n          videoContextMap.set('video-' + index, videoContext)\r\n        }\r\n        return videoContext\r\n      },\r\n      doPlay(index : number) {\r\n        uni.__f__('log','at pages/template/swiper-vertical-video/swiper-vertical-video.uvue:140',\"doPlay  video\" + index);\r\n        this.getVideoContext(index).play()\r\n      },\r\n      doStop(index : number) {\r\n        uni.__f__('log','at pages/template/swiper-vertical-video/swiper-vertical-video.uvue:144',\"doStop  video-\" + index);\r\n        this.getVideoContext(index).stop();\r\n        // TODO 临时方案：解决.stop()时触发了doPause的问题\r\n        setTimeout(() => {\r\n          this.state[index] = 'unPlay'\r\n        }, 1000)\r\n      },\r\n      doPause(index : number) {\r\n        this.getVideoContext(index).pause()\r\n        uni.__f__('log','at pages/template/swiper-vertical-video/swiper-vertical-video.uvue:153',\"doPause  video-\" + index);\r\n      },\r\n      onPause(index : number) {\r\n        this.state[index] = 'pause'\r\n        uni.__f__('log','at pages/template/swiper-vertical-video/swiper-vertical-video.uvue:157','onPause', index);\r\n      },\r\n      onPlay(index : number) {\r\n        if (this.current != index || !currentPageIsShow) {\r\n          this.onPause(index)\r\n        } else {\r\n          this.state[index] = 'play'\r\n          uni.__f__('log','at pages/template/swiper-vertical-video/swiper-vertical-video.uvue:164','onPlay', index);\r\n        }\r\n      },\r\n      getData() : ListItem[] {\r\n        let videoUrlList = state.netless\r\n          ? [\r\n              '/static/test-video/10second-demo.mp4',\r\n              '/static/test-video/10second-demo.mp4',\r\n              '/static/test-video/10second-demo.mp4'\r\n            ]\r\n          : [\r\n              'https://web-ext-storage.dcloud.net.cn/uni-app-x/video/uts-5-16.mp4',\r\n              'https://web-ext-storage.dcloud.net.cn/uni-app-x/video/uni-ai-5-16.mp4',\r\n              'https://web-ext-storage.dcloud.net.cn/uni-app-x/video/uni-verify-5-16.mp4'\r\n            ] as string[]\r\n\r\n        let posterSrcList = state.netless\r\n        ? [\r\n            '/static/shuijiao.jpg',\r\n            '/static/logo.jpg',\r\n            '/static/shuijiao.jpg'\r\n          ]\r\n        : [\r\n            'https://web-ext-storage.dcloud.net.cn/uni-app-x/dark-uni-uts-01.png',\r\n            'https://web-ext-storage.dcloud.net.cn/uni-app-x/dark-uni-ai-01.png',\r\n            'https://web-ext-storage.dcloud.net.cn/uni-app-x/dark-uni-verify-01.jpg'\r\n          ] as string[]\r\n\r\n\r\n        let list = [] as ListItem[];\r\n        for (let i = 0; i < 6; i++) {\r\n          let index = this.list.length + i;\r\n          let listItem : ListItem = {\r\n            \"_id\": \"a00\" + index,\r\n            \"content\": \"这是第\" + index + \"条数据，url地址\" + videoUrlList[i % 3],\r\n            \"src\": videoUrlList[i % 3],\r\n            \"poster_src\": posterSrcList[i % 3]\r\n          }\r\n          list.push(listItem)\r\n        }\r\n        return list\r\n      },\r\n      onSwiperChange(e : SwiperChangeEvent) {\r\n        // uni.__f__('error','at pages/template/swiper-vertical-video/swiper-vertical-video.uvue:207','SwiperChangeEvent',e.detail.current);\r\n        this.current = e.detail.current;\r\n      },\r\n      onTransition(/*e : SwiperTransitionEvent*/) {\r\n        // uni.__f__('log','at pages/template/swiper-vertical-video/swiper-vertical-video.uvue:211','onTransition e.detail.dx', e.detail.dx);\r\n      },\r\n      back() {\r\n        uni.navigateBack({\r\n          success(result) {\r\n            uni.__f__('log','at pages/template/swiper-vertical-video/swiper-vertical-video.uvue:216','navigateBack success', result.errMsg)\r\n          },\r\n          fail(error) {\r\n            uni.__f__('log','at pages/template/swiper-vertical-video/swiper-vertical-video.uvue:219','navigateBack fail', error.errMsg)\r\n          },\r\n          complete(result) {\r\n            uni.__f__('log','at pages/template/swiper-vertical-video/swiper-vertical-video.uvue:222','navigateBack complete', result.errMsg)\r\n          }\r\n        })\r\n      }\r\n    }\r\n  }\r\n</script>\r\n\r\n<style>\r\n  .page {\r\n    flex: 1;\r\n  }\r\n\r\n  .swiper,\r\n  .swiper-item,\r\n  .video-box,\r\n  .video-cover {\r\n    width: 100%;\r\n    height: 100%;\r\n  }\r\n\r\n  .swiper-item {\r\n    position: relative;\r\n  }\r\n\r\n  .video-box {\r\n    width: 100%;\r\n  }\r\n\r\n  .video-cover {\r\n    position: absolute;\r\n    justify-content: center;\r\n    align-items: center;\r\n    align-content: center;\r\n  }\r\n\r\n  .play-btn {\r\n    width: 40px;\r\n    height: 40px;\r\n  }\r\n\r\n  .video-info {\r\n    position: absolute;\r\n    bottom: 0;\r\n    padding: 15px;\r\n  }\r\n\r\n  .video-info-text {\r\n    font-size: 14px;\r\n    color: red;\r\n    line-height: 20px;\r\n  }\r\n\r\n  .debug-info {\r\n    position: fixed;\r\n    top: 15px;\r\n    width: 100%;\r\n    background-color: rgba(255, 255, 255, 0.3);\r\n  }\r\n\r\n  .status-text {\r\n    color: red;\r\n    padding: 15px;\r\n  }\r\n\r\n  .nav-back {\r\n    position: absolute;\r\n\r\n\r\n\r\n    background-color: rgba(220, 220, 220, 0.8);\r\n    border-radius: 100px;\r\n    margin: 6px;\r\n    width: 32px;\r\n    height: 32px;\r\n    justify-content: center;\r\n    align-items: center;\r\n    z-index: 10;\r\n  }\r\n\r\n  .nav-back .back-img {\r\n    width: 18px;\r\n    height: 18px;\r\n  }\r\n</style>\r\n","import MiniProgramPage from 'W:/Workplace/2.小程序/lihai-app/pages/template/swiper-vertical-video/swiper-vertical-video.uvue'\nwx.createPage(MiniProgramPage)"],"names":["defineComponent","uni","state"],"mappings":"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"}
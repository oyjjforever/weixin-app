{"version":3,"file":"swiper-list.js","sources":["pages/template/swiper-list/swiper-list.uvue","../../../Program Files/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXNcdGVtcGxhdGVcc3dpcGVyLWxpc3Rcc3dpcGVyLWxpc3QudXZ1ZQ"],"sourcesContent":["<template>\n  <view class=\"swiper-list\">\n    <scroll-view ref=\"tabScroll\" class=\"swiper-tabs\" direction=\"horizontal\" :show-scrollbar=\"false\">\n      <view class=\"flex-row\">\n        <text ref=\"swipertab\" space=\"nbsp\" class=\"swiper-tabs-item\"\n          :class=\"swiperIndex==index ? 'swiper-tabs-item-active' : ''\" v-for=\"(item, index) in swiperList\" :key=\"index\"\n          @click=\"onTabClick(index)\">\n          {{item.title}}\n        </text>\n      </view>\n      <view ref=\"indicator\" class=\"swiper-tabs-indicator\"></view>\n    </scroll-view>\n    <swiper ref=\"swiper\" class=\"swiper-view\" :current=\"swiperIndex\" @transition=\"onSwiperTransition\"\n      @animationfinish=\"onSwiperAnimationfinish\">\n      <swiper-item class=\"swiper-item\" v-for=\"(_, index) in swiperList\" :key=\"index\">\n        <text class=\"swiper-item-text\">{{index}}</text>\n        <!-- 可以将上述text组件替换为list组件，实现可左右滑动的长列表 -->\n      </swiper-item>\n    </swiper>\n  </view>\n</template>\n\n<script setup lang=\"uts\">\ntype SwiperTabsItem = {\n  x : number,\n  w : number\n}\n\ntype SwiperViewItem = {\n  title : string,\n}\n\n/**\n * 根据权重在两个值之间执行线性插值.\n * @constructor\n * @param {number} value1 - 第一个值，该值应为下限.\n * @param {number} value2 - 第二个值，该值应为上限.\n * @param {number} amount - 应介于 0 和 1 之间，指示内插的权重.\n * @returns {number} 内插值\n */\nfunction lerpNumber(value1 : number, value2 : number, amount : number) : number {\n  return (value1 + (value2 - value1) * amount)\n}\n\nconst swiperList = ref<SwiperViewItem[]>([])\nconst swiperIndex = ref(0)\nconst tabScroll = ref<UniScrollViewElement | null>(null)\nconst indicator = ref<UniElement | null>(null)\nconst swiper = ref<UniSwiperElement | null>(null)\nconst swipertab = ref<UniTextElement[] | null>(null)\nconst animationFinishIndex = ref(0)\nconst swiperWidth = ref(0)\nconst swiperTabsRect = ref<SwiperTabsItem[]>([])\n\nfunction updateTabIndicator(current_index : number, move_to_index : number, percentage : number) {\n  const current_size = swiperTabsRect.value[current_index]\n  const move_to_size = swiperTabsRect.value[move_to_index]\n  const indicator_line_x = lerpNumber(current_size.x, move_to_size.x, percentage)\n  const indicator_line_w = lerpNumber(current_size.w, move_to_size.w, percentage)\n\n\n\n\n\n  // TODO chrome windows系统 transform scaleX渲染bug\n  const x = indicator_line_x\n  indicator.value?.style?.setProperty('width', `${indicator_line_w}px`)\n  indicator.value?.style?.setProperty('transform', `translateX(${x}px)`)\n\n  const scroll_x = x - swiperWidth.value / 2\n  // app 平台后续支持 scrollTo()\n\n\n\n\n  tabScroll.value!.scrollTo({\n    left: scroll_x\n  })\n\n}\n\nfunction setSwiperIndex(index : number, updateIndicator : boolean) {\n  if (swiperIndex.value === index) {\n    return\n  }\n  swiperIndex.value = index\n  if (updateIndicator) {\n    updateTabIndicator(index, index, 1)\n  }\n}\n\nfunction onTabClick(index : number) {\n  setSwiperIndex(index, false)\n}\n\nfunction onSwiperTransition(e : SwiperTransitionEvent) {\n  const offset_x = e.detail.dx\n  const current_offset_x = offset_x % swiperWidth.value\n  const current_offset_i = offset_x / swiperWidth.value\n  const current_index = animationFinishIndex.value + parseInt(current_offset_i + '')\n  let move_to_index = current_index\n  if (current_offset_x > 0 && move_to_index < swiperList.value.length - 1) {\n    move_to_index += 1\n  } else if (current_offset_x < 0 && move_to_index > 0) {\n    move_to_index -= 1\n  }\n  const percentage = Math.abs(current_offset_x) / swiperWidth.value\n  if (current_index != move_to_index) {\n    updateTabIndicator(current_index, move_to_index, percentage)\n  }\n}\n\nfunction onSwiperAnimationfinish(e : SwiperAnimationFinishEvent) {\n  setSwiperIndex(e.detail.current, true)\n  animationFinishIndex.value = e.detail.current\n}\n\nasync function cacheTabItemsSize() {\n  swiperTabsRect.value.length = 0;\n  const tabs = swipertab.value as UniElement[]\n  for (let i = 0; i < tabs.length; i++) {\n    const element = tabs[i];\n\n    const rect = await element.getBoundingClientRectAsync()!\n    const x = rect.left\n    const w = rect.width\n\n\n\n\n\n    swiperTabsRect.value.push({\n      x,\n      w\n    } as SwiperTabsItem)\n  }\n}\n\nonLoad(() => {\n  for (let i = 0; i < 8; i++) {\n    const space = \" \".repeat(i)\n    swiperList.value.push({\n      title: \"Tab \" + space + i\n    } as SwiperViewItem)\n  }\n})\n\nonReady(() => {\n  (swiper.value as UniSwiperElement).getBoundingClientRectAsync()!.then((res : DOMRect) : Promise<void> => {\n    swiperWidth.value = res.width\n    return cacheTabItemsSize()\n  }).then(() => {\n    updateTabIndicator(swiperIndex.value, swiperIndex.value, 1)\n  });\n})\n\n</script>\n\n<style>\n  .flex-row {\n    flex-direction: row;\n    align-self: flex-start;\n  }\n\n  .swiper-list {\n    flex: 1;\n  }\n\n  .swiper-tabs {\n    background-color: #ffffff;\n  }\n\n  .swiper-tabs-item {\n    color: #555;\n    font-size: 16px;\n    padding: 12px 25px;\n    white-space: nowrap;\n  }\n\n  .swiper-tabs-item-active {\n    color: #007AFF;\n  }\n\n  .swiper-tabs-indicator {\n    width: 1px;\n    height: 2px;\n    background-color: #007AFF;\n  }\n\n  .swiper-view {\n    flex: 1;\n  }\n\n  .swiper-item {\n    flex: 1;\n    align-items: center;\n    justify-content: center;\n  }\n\n  .swiper-item-text {\n    font-size: 72px;\n    font-weight: bold;\n  }\n</style>\n","import MiniProgramPage from 'W:/Workplace/2.小程序/lihai-app/pages/template/swiper-list/swiper-list.uvue'\nwx.createPage(MiniProgramPage)"],"names":["ref","onLoad","onReady","MiniProgramPage"],"mappings":"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"}
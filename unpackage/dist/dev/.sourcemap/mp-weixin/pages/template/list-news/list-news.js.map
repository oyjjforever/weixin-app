{"version":3,"file":"list-news.js","sources":["pages/template/list-news/list-news.uvue","../../../Program Files/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXNcdGVtcGxhdGVcbGlzdC1uZXdzXGxpc3QtbmV3cy51dnVl"],"sourcesContent":["<template>\r\n  <view :class=\"['uni-container', { 'flex-row': isWideScreen }, isDarkMode ? 'theme-dark' : 'theme-light']\" style=\"flex: 1;padding: 0px;\">\r\n    <!-- 列表区域 ：宽屏时在左侧显示，窄屏时只显示列表 -->\r\n    <list-view class=\"list-container\" :class=\"{'list-narrow': isWideScreen}\" refresher-enabled=true\r\n      @refresherrefresh=\"onRefresherrefresh\" :refresher-triggered=\"refresherTriggered\" enable-back-to-top=\"true\">\r\n      <list-item class=\"banner\" @click=\"bannerClick(banner)\" type=1>\r\n        <image class=\"banner-img\" :src=\"banner.cover\"></image>\r\n        <text class=\"banner-title\">{{ banner.title }}</text>\r\n      </list-item>\r\n      <sticky-section>\r\n        <sticky-header>\r\n          <view class=\"th-item\">\r\n            <text v-for=\"(name,index) in th_item\" :key=\"index\" @click=\"clickTH(index)\" class=\"th-item-text\">\r\n              {{name}}\r\n            </text>\r\n          </view>\r\n        </sticky-header>\r\n        <list-item v-for=\"(value, index) in listData\" :key=\"index\" type=2>\r\n          <view class=\"uni-list-cell\" hover-class=\"uni-list-cell-hover\" @click=\"goDetail(value, index)\">\r\n            <view class=\"uni-media-list\">\r\n              <image v-if=\"isWideScreen\" class=\"uni-media-list-logo\" :src=\"value.cover\"></image>\r\n              <share-element v-else :share-key=\"'image_'+index\">\r\n                <image class=\"uni-media-list-logo\" :src=\"value.cover\"></image>\r\n              </share-element>\r\n              <view class=\"uni-media-list-body\">\r\n                <text class=\"uni-media-list-text-top\">{{ value.title }}</text>\r\n                <view class=\"uni-media-list-text-bottom\">\r\n                  <text class=\"uni-media-list-text\">{{ value.author_name }}</text>\r\n                  <text class=\"uni-media-list-text\">{{ value.published_at }}</text>\r\n                </view>\r\n              </view>\r\n            </view>\r\n          </view>\r\n        </list-item>\r\n      </sticky-section>\r\n    </list-view>\r\n\r\n    <!-- 详情区域：宽屏时，右侧显示-->\r\n    <view v-if=\"isWideScreen\" class=\"detail-container\">\r\n      <detail\r\n        v-if=\"post_id != '' && title != '' && cover != ''\"\r\n        :key=\"post_id\"\r\n        :post_id=\"post_id\"\r\n        :cover=\"cover\"\r\n        :title=\"title\"\r\n        :isWideScreen=\"isWideScreen\"\r\n        :firstDetailContent=\"currentDetailContent\"\r\n      />\r\n    </view>\r\n  </view>\r\n</template>\r\n\r\n<script setup lang=\"uts\">\r\n  import { state } from '@/store/index.uts'\r\n  type Banner = {\r\n    cover : string | null,\r\n    title : string | null,\r\n    post_id : string | null\r\n  }\r\n  type Item = {\r\n    author_name : string,\r\n    cover : string,\r\n    id : number,\r\n    post_id : string,\r\n    published_at : string,\r\n    title : string\r\n  }\r\n  // 导入详情组件，宽屏时，右侧直接展示详情内容\r\n  import detail from './detail/detail.uvue'\r\n\r\n  const th_item = ref([\"排序\", \"筛选\"])\r\n  const refresherTriggered = ref(false)\r\n  const banner = ref({} as Banner)\r\n  const listData = ref([] as Item[])\r\n  const last_id = ref('')\r\n  const isWideScreen = ref(false) // 是否为宽屏模式\r\n  const currentIndex = ref(0) // 当前选中的列表项索引\r\n  const post_id = ref('')\r\n  const cover = ref('')\r\n  const title = ref('')\r\n  const firstDetailContent = ref('') // 并行预加载的第一个详情内容\r\n\r\n  function checkScreenWidth() {\r\n    const deviceType = uni.getDeviceInfo().deviceType\r\n    const { windowWidth } = uni.getWindowInfo()\r\n    // 只要是pad/pc，或者宽度大于700，都算宽屏\r\n    isWideScreen.value = (\r\n      deviceType === 'pad' ||\r\n      deviceType === 'pc' ||\r\n      windowWidth > 700\r\n    )\r\n  }\r\n\r\n  function getBanner() {\r\n    let data = {\r\n      column: 'id,post_id,title,author_name,cover,published_at' //需要的字段名\r\n    };\r\n    uni.request<Banner>({\r\n      url: 'https://unidemo.dcloud.net.cn/api/banner/36kr',\r\n      data: data,\r\n      success: data => {\r\n        refresherTriggered.value = false\r\n        if (data.statusCode == 200) {\r\n          const result = data.data\r\n          if (result != null) {\r\n            banner.value = result;\r\n          }\r\n        }\r\n      },\r\n      fail: (e) => {\r\n        uni.__f__('log','at pages/template/list-news/list-news.uvue:111','fail', e);\r\n      }\r\n    });\r\n  }\r\n\r\n  function goDetail(e: Item, key: number) {\r\n    currentIndex.value = key\r\n    const detail = e;\r\n    post_id.value = detail.post_id;\r\n    cover.value = detail.cover;\r\n    title.value = detail.title;\r\n    // 窄屏时跳转到详情页，宽屏时右侧直接展示\r\n    if (!isWideScreen.value) {\r\n\r\n\r\n\r\n      uni.navigateTo({\r\n        url: '/pages/template/list-news/detail/detail?post_id=' + post_id.value + \"&cover=\" + cover.value + \"&title=\" + title.value + \"&shareKey=image_\" + key\r\n      });\r\n    }\r\n  }\r\n\r\n  function getList() {\r\n    let url = \"https://unidemo.dcloud.net.cn/api/news?column=id,post_id,title,author_name,cover,published_at\";\r\n    /* if (last_id.value != \"\") {\r\n      const minId = parseInt((last_id.value))\r\n      const time = new Date().getTime() + '';\r\n      const pageSize = 10;\r\n      url = url + \"&minId=\" + minId + \"&time=\" + time + \"&pageSize=\" + pageSize;\r\n    } */\r\n    uni.request<Item[]>({\r\n      url: url,\r\n      method: \"GET\",\r\n      success: (res) => {\r\n        if (res.statusCode == 200) {\r\n          const result = res.data\r\n          //因本接口没有更多分页数据，所以重新赋值。正常有分页的列表应该如下面push方式增加数组项\r\n          // listData.value.push(...result)\r\n          // last_id.value = listData.value[0].id + \"\";\r\n          if (result != null) {\r\n            listData.value = result\r\n            // 宽屏模式下，自动选中并展示第一个新闻详情\r\n            if (isWideScreen.value && listData.value.length > 0) {\r\n              goDetail(listData.value[0], 0)\r\n              // 并行预加载第一个详情内容，提升右侧展示速度\r\n              const first = listData.value[0]\r\n              uni.request({\r\n                url: 'https://unidemo.dcloud.net.cn/api/news/36kr/' + first.post_id,\r\n                success: (res) => {\r\n                  if (res.statusCode == 200) {\r\n                    const result = res.data as UTSJSONObject;\r\n                    firstDetailContent.value = result[\"content\"] as string\r\n                  }\r\n                }\r\n              })\r\n            }\r\n          }\r\n          refresherTriggered.value = false;\r\n        }\r\n      },\r\n      fail: (res) => {\r\n        uni.__f__('log','at pages/template/list-news/list-news.uvue:172','fail', res);\r\n        refresherTriggered.value = false\r\n      }\r\n    });\r\n  }\r\n\r\n  function bannerClick(e: Banner) {\r\n    const detail = e;\r\n    const post_id_val = detail.post_id;\r\n    let cover_val = detail.cover ?? \"\";\r\n\r\n\r\n\r\n    const title_val = detail.title;\r\n    uni.navigateTo({\r\n      url: '/pages/template/list-news/detail/detail?post_id=' + post_id_val + \"&cover=\" + cover_val + \"&title=\" + title_val\r\n    });\r\n  }\r\n\r\n  function clickTH(index: number) {\r\n    uni.showModal({\r\n      content: \"点击表头项：\" + index,\r\n      showCancel: false\r\n    });\r\n  }\r\n\r\n  function onRefresherrefresh() {\r\n    refresherTriggered.value = true\r\n    getBanner();\r\n    getList();\r\n  }\r\n\r\n  const currentDetailContent = computed(() => {\r\n    // 只在宽屏且是第一个文章时用预加载内容\r\n    if (\r\n      isWideScreen.value &&\r\n      listData.value.length > 0 &&\r\n      post_id.value === listData.value[0].post_id &&\r\n      firstDetailContent.value !== ''\r\n    ) {\r\n      return firstDetailContent.value\r\n    }\r\n    return ''\r\n  })\r\n\r\n  const isDarkMode = computed(() => state.isDarkMode)\r\n\r\n  onLoad(() => {\r\n    checkScreenWidth()\r\n    getBanner()\r\n    getList()\r\n  })\r\n\r\n  onResize(() => {\r\n    checkScreenWidth()\r\n  })\r\n</script>\r\n\r\n<style>\r\n  .flex-row {\r\n    flex-direction: row;\r\n  }\r\n\r\n  .list-container {\r\n    width: 100%;\r\n    background-color: var(--list-background-color,#ffffff);\r\n\r\n\r\n\r\n  }\r\n\r\n  .list-narrow {\r\n\r\n\r\n\r\n\r\n    width: 100px;\r\n\r\n  }\r\n  .th-item{\r\n    width: 100%;\r\n    height:44px;\r\n    background-color: var(--list-background-color,#ffffff);\r\n    flex-direction: row;\r\n    justify-content:center;\r\n    align-items:center;\r\n  }\r\n  .th-item-text{\r\n    margin-right: 20px;\r\n    color: var(--text-color,#333333);\r\n  }\r\n\r\n  .detail-container {\r\n    flex: 1;\r\n    min-width: 0;\r\n    /* 防止溢出 */\r\n    padding: 20px;\r\n    background-color: var(--background-color,#f8f8f8);\r\n\r\n\r\n\r\n  }\r\n\r\n  .banner {\r\n    height: 180px;\r\n    overflow: hidden;\r\n    position: relative;\r\n    background-color: var(--background-color,#f8f8f8);\r\n  }\r\n\r\n  .banner-img {\r\n    width: 100%;\r\n  }\r\n\r\n  .banner-title {\r\n    max-height: 42px;\r\n    overflow: hidden;\r\n    position: absolute;\r\n    left: 15px;\r\n    bottom: 15px;\r\n    width: 90%;\r\n    font-size: 16px;\r\n    font-weight: 400;\r\n    line-height: 21px;\r\n    color: white;\r\n  }\r\n\r\n  .uni-media-list {\r\n    padding: 11px 15px;\r\n    box-sizing: border-box;\r\n    display: flex;\r\n    width: 100%;\r\n    flex-direction: row;\r\n  }\r\n\r\n  .uni-media-list-logo {\r\n    width: 90px;\r\n    height: 70px;\r\n  }\r\n\r\n  .uni-media-list-body {\r\n    flex: 1;\r\n    padding-left: 7px;\r\n    justify-content: space-around;\r\n  }\r\n\r\n  .uni-media-list-text-top {\r\n    /* height: 37px; */\r\n    font-size: 14px;\r\n    lines: 2;\r\n    overflow: hidden;\r\n    color: var(--text-color,#333333);\r\n  }\r\n\r\n  .uni-media-list-text-bottom {\r\n    display: flex;\r\n    flex-direction: row;\r\n    justify-content: space-between;\r\n  }\r\n\r\n  .uni-media-list-text {\r\n    color: #9D9D9F;\r\n    font-size: 13px;\r\n  }\r\n</style>\r\n","import MiniProgramPage from 'W:/Workplace/2.小程序/lihai-app/pages/template/list-news/list-news.uvue'\nwx.createPage(MiniProgramPage)"],"names":["ref","uni","data","detail","res","computed","state","onLoad","onResize","MiniProgramPage"],"mappings":"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"}
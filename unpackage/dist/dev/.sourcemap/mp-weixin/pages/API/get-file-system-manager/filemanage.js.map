{"version":3,"file":"filemanage.js","sources":["pages/API/get-file-system-manager/filemanage.uvue","../../../Program Files/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXNcQVBJXGdldC1maWxlLXN5c3RlbS1tYW5hZ2VyXGZpbGVtYW5hZ2UudXZ1ZQ"],"sourcesContent":["<template>\n\t<view style=\"flex-direction: row;\" id=\"rootview\">\n\t\t<radio-group @change=\"switchCacheOrData\">\n      <radio value=\"data\" :checked=\"true\">数据目录</radio>\n      <radio value=\"cache\"\n\n      disabled\n\n      >缓存目录</radio>\n    </radio-group>\n    <button @click=\"refreshFile\">刷新</button>\n\n\n\n\t\t<button @click=\"snapshot\">截图</button>\n\t</view>\n  <text>文件总数：{{ count }}；\\n文件总大小：{{size}} M</text>\n\t<text style=\"border: 1px solid #ccc;margin: 5px;\">根路径：{{rootPath}}</text>\n\t<list-view style=\"flex: 1;\">\n\t\t<list-item v-for=\"(item, index) in fileList\" :key=\"index\" style=\"padding: 5px;border-bottom: 1px solid #ccc;\" :style=\"getIndentStyle(item.shotPath)\"\n\t\t@click=\"showDialog(item)\">\n\t\t\t<view style=\"flex-direction: row;\">\n\t\t\t\t<!-- <text style=\"font-family: uni-icon;\" v-if=\"!item.isFile\">\\uE661</text> -->\n\n\n\n\n\t\t\t\t<text >{{(item.shotPath as string)}}</text>\n\t\t\t</view>\n\t\t\t<text style=\"font-size: 12px;color: #ccc;\" v-if=\"item.isFile\" >{{item.size}}k</text>\n\t\t</list-item>\n\t</list-view>\n\t<view v-if=\"dialogShow\" style=\"position: fixed; top: 0; bottom: 0; left: 0; right: 0; align-items: center; justify-content: center; z-index: 1000; background-color: rgba(16, 16, 16, 0.5);\">\n\t\t<view style=\"background-color: #fff;padding: 10px;border-radius: 10px;width: 90%;margin: 0 auto;\">\n\t\t\t<text style=\"font-size: 20px;font-weight: bold;\">{{currentFile.shotPath}}</text>\n\t\t\t<text>类型：{{currentFile.isFile ? '文件' : '目录'}}</text>\n\t\t\t<text>路径：{{currentFile.path}}</text>\n\t\t\t<text>大小：{{currentFile.size}}k</text>\n\t\t\t<text>修改时间：{{currentFile.modifyTime}}</text>\n\t\t\t<view style=\"flex-direction: row;width: 100%;justify-content: space-between;padding: 10px;\">\n\t\t\t\t<button @click=\"openFile(currentFile)\" size=\"mini\" v-if=\"currentFile.isFile\">打开</button>\n\t\t\t\t<button @click=\"deleteFile(currentFile)\" size=\"mini\">删除</button>\n\t\t\t\t<button @click=\"closeDialog\" size=\"mini\">关闭</button>\n\t\t\t</view>\n\t\t</view>\n\t</view>\n</template>\n\n<script setup lang=\"uts\">\n\ttype fileListType = {\n\t\tpath : string,\n\t\tshotPath : string,\n\t\tsize : number,\n\t\tisFile : boolean,\n\t\tmodifyTime : string\n\t}\n\tlet fileList = ref([] as fileListType[])\n\tlet count = ref(0), size = ref(0)\n\tlet rootPath = ref(\"\")\n\tlet dialogShow = ref(false)\n\tconst uniIcon = ref(\"\\uE661\")\n\tlet currentFile = ref({\"path\":\"\",\"shotPath\":\"\",\"size\":0,isFile:false,modifyTime:''} as fileListType)\n  let cacheOrData = ref(uni.env.USER_DATA_PATH)\n\n  const switchCacheOrData = (e : UniRadioGroupChangeEvent) => {\n\t\tcacheOrData.value = (e.detail.value==\"cache\") ? uni.env.CACHE_PATH : uni.env.USER_DATA_PATH\n\t}\n\n// 遍历文件刷新列表\n\tconst refreshFile = () => {\n\t  const fileManager = uni.getFileSystemManager()\n\t  fileManager.stat({\n\t    // path: uni.env.CACHE_PATH, //沙盒cache目录\n\t    // path: uni.env.USER_DATA_PATH, //沙盒根目录\n      path: cacheOrData.value,\n\t    recursive: true,\n\t    success: (res : StatSuccessResult) => {\n\t\t\t\t// log.value += 'statFileInfoTest success:' + JSON.stringify(res) + '\\n\\n'\n\t      uni.__f__('log','at pages/API/get-file-system-manager/filemanage.uvue:79','statFileInfo success1')\n\t      uni.__f__('log','at pages/API/get-file-system-manager/filemanage.uvue:80','res.stats', res.stats)\n\t\t\t\tuni.__f__('log','at pages/API/get-file-system-manager/filemanage.uvue:81','uni.env.CACHE_PATH: ',uni.env.CACHE_PATH);\n\t\t\t\tuni.__f__('log','at pages/API/get-file-system-manager/filemanage.uvue:82','uni.env.USER_DATA_PATH: ',uni.env.USER_DATA_PATH);\n\t\t\t\tuni.__f__('log','at pages/API/get-file-system-manager/filemanage.uvue:83','uni.env.SANDBOX_PATH: ',uni.env.SANDBOX_PATH);\n\t\t\t\tlet tempFileList = [] as fileListType[]\n\t\t\t\tlet tempSize = 0\n\t\t\t\tfor (let i=0;i<res.stats.length;i++) {\n\t\t\t\t\tuni.__f__('log','at pages/API/get-file-system-manager/filemanage.uvue:87',\"resitem\",res.stats[i].path);\n          if (i==0) {\n            rootPath.value = res.stats[i].path\n\t\t\t\t\t\tcontinue\n          }\n\t\t\t\t\tlet tempFileItem = {\n\t\t\t\t\t\t\"path\":\"\",\n\t\t\t\t\t\t\"shotPath\":\"\",\n\t\t\t\t\t\t\"size\":0,\n\t\t\t\t\t\tisFile:false,\n\t\t\t\t\t\tmodifyTime:''\n\t\t\t\t\t} as fileListType\n\n\t\t\t\t\ttempFileItem.shotPath = res.stats[i].path.replace(rootPath.value, \"\")\n\t\t\t\t\ttempFileItem.path = res.stats[i].path\n\t\t\t\t\ttempFileItem.size = res.stats[i].stats.size/1024\n\t\t\t\t\ttempFileItem.isFile = res.stats[i].stats.isFile()\n\t\t\t\t\tconst mdate = new Date(res.stats[i].stats.lastModifiedTime * 1000)\n\t\t\t\t\ttempFileItem.modifyTime = mdate.getFullYear().toString() + \"-\" + (mdate.getMonth()+1).toString() + \"-\" + mdate.getDate().toString() + \" \"\n\t\t\t\t\t+ mdate.getHours().toString() + \":\" + mdate.getMinutes().toString() + \":\" + mdate.getSeconds().toString()\n\t\t\t\t\ttempSize = tempSize + res.stats[i].stats.size\n\t\t\t\t\ttempFileList.push(tempFileItem)\n\t\t\t\t}\n\t\t\t\tfileList.value = tempFileList\n\t\t\t\tsize.value = tempSize/1024/1024\n\t\t\t\tcount.value = tempFileList.length\n\t    },\n\t    fail: (res : IUniError) => {\n        uni.showModal({\n        \ttitle: '获取文件状态失败',\n        \tcontent: res.errMsg,\n        \tshowCancel: false\n        })\n\t      uni.__f__('error','at pages/API/get-file-system-manager/filemanage.uvue:120','statFileInfo fail', res)\n\t    },\n\t    complete: (res : any) => {\n\t      uni.__f__('log','at pages/API/get-file-system-manager/filemanage.uvue:123',\"statFileInfo complete\", res)\n\t    }\n\t  } as StatOptions)\n\t}\n\n\tconst showDialog = (item: fileListType) => {\n\t\tcurrentFile.value = item\n\t\tdialogShow.value = true\n\t}\n\tconst closeDialog = () => {\n\t\tdialogShow.value = false\n\t}\n\n\tconst deleteFile = (fileItem: fileListType) => {\n    const fileManager = uni.getFileSystemManager()\n    let path = cacheOrData.value + fileItem.path\n    if (fileItem.isFile) {\n      fileManager.unlink({\n      \tfilePath: path,\n      \tsuccess: () => {\n      \t\trefreshFile()\n      \t\tcloseDialog()\n      \t},\n      \tfail: (err : IFileSystemManagerFail) => {\n      \t\tuni.showModal({\n      \t\t\ttitle: '删除文件失败',\n      \t\t\tcontent: err.errMsg,\n      \t\t\tshowCancel: false\n      \t\t})\n      \t}\n      })\n    } else {\n      fileManager.rmdir({\n      \tdirPath: path,\n        recursive: true,\n      \tsuccess: () => {\n      \t\trefreshFile()\n      \t\tcloseDialog()\n      \t},\n      \tfail: (err : IFileSystemManagerFail) => {\n      \t\tuni.showModal({\n      \t\t\ttitle: '删除目录失败',\n      \t\t\tcontent: err.errMsg,\n      \t\t\tshowCancel: false\n      \t\t})\n      \t}\n      })\n    }\n\t}\n\n\tconst clearFile = () => {\n    const fileManager = uni.getFileSystemManager()\n    // TODO 3个App平台表现不一致 @颜伊林\n    fileManager.rmdir({\n      \"dirPath\":uni.env.CACHE_PATH,\n      \"recursive\":true,\n      success: (res : FileManagerSuccessResult) => {\n        uni.__f__('log','at pages/API/get-file-system-manager/filemanage.uvue:180',\"rmdir success\", res)\n        fileList.value = [] as fileListType[]\n        size.value = 0\n        count.value = 0\n        uni.showToast({\n          title:\"清空缓存目录成功\",\n          icon:\"success\"\n        })\n      },\n      fail: (res : IFileSystemManagerFail) => {\n        uni.__f__('error','at pages/API/get-file-system-manager/filemanage.uvue:190','清空缓存目录失败', res)\n        uni.showModal({\n        \ttitle: '清空缓存目录失败',\n        \tcontent: res.errMsg,\n        \tshowCancel: false\n        })\n      },\n      complete: (res : any) => {\n        uni.__f__('log','at pages/API/get-file-system-manager/filemanage.uvue:198',\"rmdir complete\", res)\n      }\n    })\n  }\n\n  const openFile = (fileItem: fileListType) => {\n\t\tlet path = cacheOrData.value + fileItem.path\n\t\tlet suffix = path.split('.').pop()\n\t\tswitch(suffix) {\n\t\t\tcase 'jpg':\n\t\t\tcase 'png':\n\t\t\tcase 'gif':\n\t\t\tcase 'jpeg':\n\t\t\tcase 'webp':\n\t\t\tcase 'bmp':\n\t\t\tcase 'ico':\n\t\t\tcase 'heic':\n\t\t\tcase 'heif':\n\t\t\tcase 'tif':\n\t\t\t\tuni.__f__('log','at pages/API/get-file-system-manager/filemanage.uvue:217',\"path:\", path)\n\t\t\t\tuni.previewImage({\n\t\t\t\t\turls: [path]\n\t\t\t\t})\n\t\t\t\tbreak\n\n      default:\n        uni.openDocument({\n        \tfilePath: path,\n        \tsuccess: (res) => {\n        \t\tuni.__f__('log','at pages/API/get-file-system-manager/filemanage.uvue:227',\"openDocument success\", res)\n        \t},\n        \tfail: (res) => {\n        \t\tuni.__f__('error','at pages/API/get-file-system-manager/filemanage.uvue:230',\"openDocument fail\", res)\n            uni.showModal({\n            \ttitle: '打开文件失败',\n            \tcontent: res.errMsg,\n            \tshowCancel: false\n            })\n        \t}\n        })\n\n\t\t}\n  }\n\tconst snapshot = () => {\n\t\t\tuni.getElementById(\"rootview\")!.takeSnapshot({})\n\t}\n\n// 根据路径中/的数量计算缩进样式\n\tconst getIndentStyle = (path: string) => {\n\t\tconst matches = path.match(/\\//g)\n\t\t// uni.__f__('log','at pages/API/get-file-system-manager/filemanage.uvue:248',\"matches\", matches)\n\t\tlet level = 0\n\t\tif (matches!=null) {\n\t\t\tlevel = matches.length\n\t\t}\n\t\treturn {\n\t\t\tpaddingLeft: `${level * 20}px`\n\n\t\t}\n\t}\n\n</script>\n","import MiniProgramPage from 'W:/Workplace/2.小程序/lihai-app/pages/API/get-file-system-manager/filemanage.uvue'\nwx.createPage(MiniProgramPage)"],"names":["ref","uni","MiniProgramPage"],"mappings":";;MAiDM,qBAAY,IAAA,QAAA;AAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAOjB,QAAI,WAAWA,kBAAI,CAAA,CAAoB;AACvC,QAAI,QAAQA,cAAAA,IAAI,CAAC,GAAG,OAAOA,cAAAA,IAAI,CAAC;AAChC,QAAI,WAAWA,kBAAI,EAAE;AACrB,QAAI,aAAaA,kBAAI,KAAK;AACVA,kBAAAA,IAAI,GAAQ;AAC5B,QAAI,cAAcA,cAAAA,IAAI,IAAA,aAAA,EAAC,QAAO,IAAG,YAAW,IAAG,QAAO,GAAE,QAAO,OAAM,YAAW,GAAmB,CAAA,CAAA;AAClG,QAAI,cAAcA,cAAG,IAACC,cAAG,MAAC,IAAI,cAAc;AAE5C,UAAM,oBAAoB,CAAC,MAA4B;AACvD,kBAAY,QAAS,EAAE,OAAO,SAAO,UAAWA,cAAG,MAAC,IAAI,aAAaA,oBAAI,IAAI;AAAA,IAC9E;AAGA,UAAM,cAAc,MAAA;AAClB,YAAM,cAAcA,oBAAI;AACxB,kBAAY,KAAK;AAAA;AAAA;AAAA,QAGd,MAAM,YAAY;AAAA,QACnB,WAAW;AAAA,QACX,SAAS,CAAC,QAAuB;AAE/BA,wBAAAA,MAAI,MAAM,OAAM,2DAA0D,uBAAuB;AACjGA,wBAAG,MAAC,MAAM,OAAM,2DAA0D,aAAa,IAAI,KAAK;AACnGA,8BAAI,MAAM,OAAM,2DAA0D,wBAAuBA,oBAAI,IAAI,UAAU;AACnHA,8BAAI,MAAM,OAAM,2DAA0D,4BAA2BA,oBAAI,IAAI,cAAc;AAC3HA,8BAAI,MAAM,OAAM,2DAA0D,0BAAyBA,oBAAI,IAAI,YAAY;AACvH,cAAI,eAAe,CAAA;AACnB,cAAI,WAAW;AACf,mBAAS,IAAE,GAAE,IAAE,IAAI,MAAM,QAAO,KAAK;AACpCA,gCAAI,MAAM,OAAM,2DAA0D,WAAU,IAAI,MAAM,CAAC,EAAE,IAAI;AAChG,gBAAI,KAAG,GAAG;AACR,uBAAS,QAAQ,IAAI,MAAM,CAAC,EAAE;AACpC;AAAA,YACK;AACN,gBAAI,eAAe,IAAA,aAAA;AAAA,cAClB,QAAO;AAAA,cACP,YAAW;AAAA,cACX,QAAO;AAAA,cACP,QAAO;AAAA,cACP,YAAW;AAAA,YACK,CAAA;AAEjB,yBAAa,WAAW,IAAI,MAAM,CAAC,EAAE,KAAK,QAAQ,SAAS,OAAO,EAAE;AACpE,yBAAa,OAAO,IAAI,MAAM,CAAC,EAAE;AACjC,yBAAa,OAAO,IAAI,MAAM,CAAC,EAAE,MAAM,OAAK;AAC5C,yBAAa,SAAS,IAAI,MAAM,CAAC,EAAE,MAAM;AACzC,kBAAM,QAAQ,IAAI,KAAK,IAAI,MAAM,CAAC,EAAE,MAAM,mBAAmB,GAAI;AACjE,yBAAa,aAAa,MAAM,YAAa,EAAC,SAAU,IAAG,OAAO,MAAM,SAAQ,IAAG,GAAG,SAAQ,IAAK,MAAM,MAAM,QAAS,EAAC,SAAQ,IAAK,MACpI,MAAM,SAAU,EAAC,SAAQ,IAAK,MAAM,MAAM,WAAY,EAAC,SAAQ,IAAK,MAAM,MAAM,WAAY,EAAC,SAAQ;AACvG,uBAAW,WAAW,IAAI,MAAM,CAAC,EAAE,MAAM;AACzC,yBAAa,KAAK,YAAY;AAAA,UAC9B;AACD,mBAAS,QAAQ;AACjB,eAAK,QAAQ,WAAS,OAAK;AAC3B,gBAAM,QAAQ,aAAa;AAAA,QACzB;AAAA,QACD,MAAM,CAAC,QAAe;AACnBA,8BAAI,UAAU,IAAA,cAAA;AAAA,YACb,OAAO;AAAA,YACP,SAAS,IAAI;AAAA,YACb,YAAY;AAAA,UACZ,CAAA,CAAA;AACFA,wBAAG,MAAC,MAAM,SAAQ,4DAA2D,qBAAqB,GAAG;AAAA,QACtG;AAAA,QACD,UAAU,CAAC,MAAS,SAAA;AAClBA,wBAAG,MAAC,MAAM,OAAM,4DAA2D,yBAAyB,GAAG;AAAA,QACzG;AAAA,MACc,CAAA;AAAA,IAClB;AAEA,UAAM,aAAa,CAAC,SAAkB;AACrC,kBAAY,QAAQ;AACpB,iBAAW,QAAQ;AAAA,IACpB;AACA,UAAM,cAAc,MAAA;AACnB,iBAAW,QAAQ;AAAA,IACpB;AAEA,UAAM,aAAa,CAAC,aAAsB;AACvC,YAAM,cAAcA,oBAAI;AACxB,UAAI,OAAO,YAAY,QAAQ,SAAS;AACxC,UAAI,SAAS,QAAQ;AACnB,oBAAY,OAAO;AAAA,UAClB,UAAU;AAAA,UACV,SAAS,MAAA;AACR;AACA;UACA;AAAA,UACD,MAAM,CAAC,QAA4B;AAClCA,gCAAI,UAAU,IAAA,cAAA;AAAA,cACb,OAAO;AAAA,cACP,SAAS,IAAI;AAAA,cACb,YAAY;AAAA,YACZ,CAAA,CAAA;AAAA,UACF;AAAA,QACA,CAAA;AAAA,MACF,OAAM;AACL,oBAAY,MAAM;AAAA,UACjB,SAAS;AAAA,UACR,WAAW;AAAA,UACZ,SAAS,MAAA;AACR;AACA;UACA;AAAA,UACD,MAAM,CAAC,QAA4B;AAClCA,gCAAI,UAAU,IAAA,cAAA;AAAA,cACb,OAAO;AAAA,cACP,SAAS,IAAI;AAAA,cACb,YAAY;AAAA,YACZ,CAAA,CAAA;AAAA,UACF;AAAA,QACA,CAAA;AAAA,MACF;AAAA,IACJ;AAgCC,UAAM,WAAW,CAAC,aAAsB;AACxC,UAAI,OAAO,YAAY,QAAQ,SAAS;AACxC,UAAI,sBAAS,KAAK,MAAM,GAAG,CAAC;AAC5B,cAAO,QAAM;AAAA,QACZ,KAAK;AAAA,QACL,KAAK;AAAA,QACL,KAAK;AAAA,QACL,KAAK;AAAA,QACL,KAAK;AAAA,QACL,KAAK;AAAA,QACL,KAAK;AAAA,QACL,KAAK;AAAA,QACL,KAAK;AAAA,QACL,KAAK;AACJA,wBAAG,MAAC,MAAM,OAAM,4DAA2D,SAAS,IAAI;AACxFA,wBAAAA,MAAI,aAAa;AAAA,YAChB,MAAM,CAAC,IAAI;AAAA,UACX,CAAA;AACD;AAAA,QAEE;AACEA,wBAAAA,MAAI,aAAa;AAAA,YAChB,UAAU;AAAA,YACV,SAAS,CAAC,QAAG;AACZA,4BAAG,MAAC,MAAM,OAAM,4DAA2D,wBAAwB,GAAG;AAAA,YACtG;AAAA,YACD,MAAM,CAAC,QAAG;AACTA,4BAAG,MAAC,MAAM,SAAQ,4DAA2D,qBAAqB,GAAG;AACnGA,kCAAI,UAAU,IAAA,cAAA;AAAA,gBACb,OAAO;AAAA,gBACP,SAAS,IAAI;AAAA,gBACb,YAAY;AAAA,cACZ,CAAA,CAAA;AAAA,YACJ;AAAA,UACA,CAAA;AAAA,MAEN;AAAA,IACD;AACD,UAAM,WAAW,MAAA;AACfA,oBAAAA,MAAI,eAAe,UAAU,EAAG,aAAa,CAAE,CAAA;AAAA,IACjD;AAGA,UAAM,iBAAiB,CAAC,SAAY;AACnC,YAAM,UAAU,KAAK,MAAM,KAAK;AAEhC,UAAI,QAAQ;AACZ,UAAI,WAAS,MAAM;AAClB,gBAAQ,QAAQ;AAAA,MAChB;AACD,aAAO,IAAA,cAAA;AAAA,QACN,aAAa,GAAG,QAAQ,EAAE;AAAA,OAE1B;AAAA,IACF;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC/PD,GAAG,WAAWC,SAAe;"}
{"version":3,"file":"request-merchant-transfer.js","sources":["pages/API/request-merchant-transfer/request-merchant-transfer.uvue","../../../Program Files/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvQVBJL3JlcXVlc3QtbWVyY2hhbnQtdHJhbnNmZXIvcmVxdWVzdC1tZXJjaGFudC10cmFuc2Zlci51dnVl"],"sourcesContent":["<template>\n  <view class=\"content\">\n    <button class=\"button\" @click=\"pay\">支付0.2元</button>\n    <button class=\"button\" @click=\"transfer\" :disabled=\"disabled\">接受0.1元转账</button>\n    <view class=\"tips\" v-if=\"disabled\" style=\"color: #ff5a5f;\">请先支付 0.2 元，才能体验接收转账 0.1 元</view>\n\n    <view class=\"tips\" v-else><text style=\"color: #42b983;\">若已支付 0.2 元，请点击“接受0.1元转账”按钮</text></view>\n\n\n\n\n\n  </view>\n</template>\n\n<script lang=\"uts\">\n  export default {\n    data() {\n      return {\n        outTradeNo: \"\",\n        disabled: true,\n        openid: \"\"\n      }\n    },\n    onLoad() {\n      // this.outTradeNo = \"test17404775193789726\";\n      // this.disabled = false;\n\n      this.getOpenId();\n\n    },\n    methods: {\n      pay() {\n        let bundleId = this.getBundleId();\n        let random = Math.floor(Math.random() * 9000) + 1000;\n        this.outTradeNo = `test${Date.now()}${random}`;\n        uni.__f__('log','at pages/API/request-merchant-transfer/request-merchant-transfer.uvue:37','outTradeNo: ', this.outTradeNo)\n        this.disabled = true;\n        uni.showLoading({\n          title: \"请求中...\"\n        });\n\n\n\n\n\n\n\n\n\n\n\n\n\n        uni.request({\n          url: \"https://env-00jxt67zj8kj.dev-hz.cloudbasefunction.cn/uni-pay-api/getOrderInfo\",\n          method: \"GET\",\n          data: {\n            outTradeNo: this.outTradeNo,\n            bundleId,\n            openid: this.openid\n          },\n          success: (res) => {\n            uni.hideLoading();\n            let data = res.data as UTSJSONObject;\n            let errCode = data['errCode'] as number;\n            if (errCode != 0) {\n              uni.showModal({\n                title: \"提示\",\n                content: data['errMsg'] as string,\n                showCancel: false\n              });\n              return;\n            }\n            let orderInfo = data[\"orderInfo\"] as string;\n            uni.__f__('log','at pages/API/request-merchant-transfer/request-merchant-transfer.uvue:76','orderInfo: ', orderInfo)\n\n            setTimeout(() => {\n              this.disabled = false;\n            }, 3000);\n\n            uni.requestPayment({\n              provider: \"wxpay\",\n              orderInfo: orderInfo,\n\n              ...JSON.parse(orderInfo),\n\n              success: (res) => {\n                uni.__f__('log','at pages/API/request-merchant-transfer/request-merchant-transfer.uvue:89','res: ', res)\n                uni.showToast({\n                  title: \"支付成功\",\n                  icon: 'success'\n                });\n                this.disabled = false;\n              },\n              fail: (err) => {\n                uni.__f__('error','at pages/API/request-merchant-transfer/request-merchant-transfer.uvue:97',\"err\", err);\n                uni.hideLoading();\n                uni.showToast({\n                  title: \"支付失败\",\n                  icon: 'error'\n                });\n              }\n            });\n          },\n          fail: (err) => {\n            uni.hideLoading();\n            uni.__f__('error','at pages/API/request-merchant-transfer/request-merchant-transfer.uvue:108',\"request-err\", err);\n          }\n        });\n      },\n      transfer() {\n        uni.showLoading({\n          title: \"请求中...\"\n        });\n        try {\n          let bundleId = this.getBundleId();\n          uni.request({\n            url: \"https://env-00jxt67zj8kj.dev-hz.cloudbasefunction.cn/uni-pay-api/transfer\",\n            method: \"GET\",\n            data: {\n              outTradeNo: this.outTradeNo,\n              bundleId\n            },\n            success: (res) => {\n              let data = res.data as UTSJSONObject;\n              if (data['errCode'] != null && typeof data['errCode'] == \"number\" && data['errCode'] == 0) {\n                let options = data['options'] as UTSJSONObject;\n                uni.requestMerchantTransfer({\n                  mchId: options['mchId'] as string,\n                  appId: options['appId'] as string,\n                  package: options['package'] as string,\n                  success: (res) => {\n                    uni.hideLoading();\n                    uni.__f__('log','at pages/API/request-merchant-transfer/request-merchant-transfer.uvue:135','res: ', res)\n                    uni.showToast({\n                      title: \"转账成功\",\n                      icon: 'success'\n                    });\n                    this.disabled = true;\n                  },\n                  fail: (err) => {\n                    uni.hideLoading();\n                    let errMsg = err.errMsg;\n                    if (errMsg == \"requestMerchantTransfer:fail cancel\") {\n                      errMsg = \"取消转账\";\n                    }\n                    uni.showToast({\n                      title: errMsg,\n                      icon: 'none'\n                    });\n                    uni.__f__('error','at pages/API/request-merchant-transfer/request-merchant-transfer.uvue:152',\"转账失败\", err);\n                  }\n                });\n              } else {\n                uni.hideLoading();\n                if (data['errMsg'] != null) {\n                  uni.showModal({\n                    title: \"提示\",\n                    content: data['errMsg'] as string,\n                    showCancel: false\n                  });\n                }\n                return;\n              }\n            },\n            fail: (err) => {\n              uni.__f__('error','at pages/API/request-merchant-transfer/request-merchant-transfer.uvue:168',\"request-err\", err);\n              uni.hideLoading();\n            }\n          });\n        } catch (err) {\n          uni.__f__('error','at pages/API/request-merchant-transfer/request-merchant-transfer.uvue:173','err: ', err)\n          uni.showToast({\n            title: \"运行异常\",\n            icon: 'error'\n          });\n          uni.hideLoading();\n        }\n      },\n      getBundleId() : string | null {\n        let baseInfo = uni.getAppBaseInfo();\n        let bundleId : string | null;\n\n\n\n\n\n\n\n        bundleId = uni.getAccountInfoSync().miniProgram.appId;\n\n        return bundleId;\n      },\n\n      getOpenId() {\n        uni.showLoading({\n          title: \"请稍等...\",\n          mask: true\n        });\n        let bundleId = this.getBundleId();\n        uni.login({\n          provider: 'weixin',\n          success: (res) => {\n            uni.request({\n              url: \"https://env-00jxt67zj8kj.dev-hz.cloudbasefunction.cn/uni-pay-api/getOpenId\",\n              method: \"GET\",\n              data: {\n                code: res.code,\n                bundleId\n              },\n              success: (res) => {\n                uni.hideLoading();\n                this.openid = res.data.openid;\n                uni.__f__('log','at pages/API/request-merchant-transfer/request-merchant-transfer.uvue:215','openid: ', this.openid);\n              },\n              fail: (err) => {\n                uni.hideLoading();\n                uni.__f__('error','at pages/API/request-merchant-transfer/request-merchant-transfer.uvue:219',\"request-err\", err);\n              }\n            });\n          }\n        })\n      },\n\n    }\n  }\n</script>\n\n<style>\n  .content {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: center;\n    padding: 20px;\n  }\n\n  .button {\n    width: 100%;\n    margin-bottom: 20px;\n    border-radius: 5px;\n  }\n\n  .tips {\n    color: #999;\n    font-size: 14px;\n  }\n</style>\n","import MiniProgramPage from 'W:/Workplace/2.小程序/lihai-app/pages/API/request-merchant-transfer/request-merchant-transfer.uvue'\nwx.createPage(MiniProgramPage)"],"names":["defineComponent","uni","res"],"mappings":";;AAgBE,MAAA,YAAeA,8BAAA;AAAA,EACb,OAAI;AACF,WAAO;AAAA,MACL,YAAY;AAAA,MACZ,UAAU;AAAA,MACV,QAAQ;AAAA;EAEX;AAAA,EACD,SAAM;AAIJ,SAAK,UAAS;AAAA,EAEf;AAAA,EACD,SAAS;AAAA,IACP,MAAG;AACD,UAAI,WAAW,KAAK;AACpB,UAAI,SAAS,KAAK,MAAM,KAAK,WAAW,GAAI,IAAI;AAChD,WAAK,aAAa,OAAO,KAAK,KAAK,GAAG,MAAM;AAC5CC,oBAAG,MAAC,MAAM,OAAM,4EAA2E,gBAAgB,KAAK,UAAU;AAC1H,WAAK,WAAW;AAChBA,oBAAAA,MAAI,YAAY;AAAA,QACd,OAAO;AAAA,MACR,CAAA;AAcDA,oBAAAA,MAAI,QAAQ;AAAA,QACV,KAAK;AAAA,QACL,QAAQ;AAAA,QACR,MAAM,IAAA,cAAA;AAAA,UACJ,YAAY,KAAK;AAAA,UACjB;AAAA,UACA,QAAQ,KAAK;AAAA,SACd;AAAA,QACD,SAAS,CAAC,QAAG;AACXA,wBAAG,MAAC,YAAW;AACf,cAAI,OAAO,IAAI;AACf,cAAI,UAAU,KAAK,SAAS;AAC5B,cAAI,WAAW,GAAG;AAChBA,gCAAI,UAAU,IAAA,cAAA;AAAA,cACZ,OAAO;AAAA,cACP,SAAS,KAAK,QAAQ;AAAA,cACtB,YAAY;AAAA,YACb,CAAA,CAAA;AACD,mBAAM;AAAA,UACR;AACA,cAAI,YAAY,KAAK,WAAW;AAChCA,wBAAG,MAAC,MAAM,OAAM,4EAA2E,eAAe,SAAS;AAEnH,qBAAW,MAAA;AACT,iBAAK,WAAW;AAAA,UACjB,GAAE,GAAI;AAEPA,8BAAI,eACF,OAAA,OAAA,OAAA,OAAA,EAAA,UAAU,SACV,aAEG,IAAK,KAAA,MAAM,SAAS,CAAC,KAExB,SAAS,CAACC,SAAG;AACXD,0BAAG,MAAC,MAAM,OAAM,4EAA2E,SAASC,IAAG;AACvGD,0BAAAA,MAAI,UAAU;AAAA,cACZ,OAAO;AAAA,cACP,MAAM;AAAA,YACP,CAAA;AACD,iBAAK,WAAW;AAAA,UAClB,GACA,MAAM,CAAC,QAAG;AACRA,0BAAG,MAAC,MAAM,SAAQ,4EAA2E,OAAO,GAAG;AACvGA,0BAAG,MAAC,YAAW;AACfA,0BAAAA,MAAI,UAAU;AAAA,cACZ,OAAO;AAAA,cACP,MAAM;AAAA,YACP,CAAA;AAAA,UACH,EAAA;QAEH;AAAA,QACD,MAAM,CAAC,QAAG;AACRA,wBAAG,MAAC,YAAW;AACfA,wBAAG,MAAC,MAAM,SAAQ,6EAA4E,eAAe,GAAG;AAAA,QAClH;AAAA,MACD,CAAA;AAAA,IACF;AAAA,IACD,WAAQ;AACNA,oBAAAA,MAAI,YAAY;AAAA,QACd,OAAO;AAAA,MACR,CAAA;AACD,UAAI;AACF,YAAI,WAAW,KAAK;AACpBA,sBAAAA,MAAI,QAAQ;AAAA,UACV,KAAK;AAAA,UACL,QAAQ;AAAA,UACR,MAAM,IAAA,cAAA;AAAA,YACJ,YAAY,KAAK;AAAA,YACjB;AAAA,WACD;AAAA,UACD,SAAS,CAAC,QAAG;AACX,gBAAI,OAAO,IAAI;AACf,gBAAI,KAAK,SAAS,KAAK,QAAQ,OAAO,KAAK,SAAS,KAAK,YAAY,KAAK,SAAS,KAAK,GAAG;AACzF,kBAAI,UAAU,KAAK,SAAS;AAC5BA,4BAAAA,MAAI,wBAAwB;AAAA,gBAC1B,OAAO,QAAQ,OAAO;AAAA,gBACtB,OAAO,QAAQ,OAAO;AAAA,gBACtB,SAAS,QAAQ,SAAS;AAAA,gBAC1B,SAAS,CAACC,SAAG;AACXD,gCAAG,MAAC,YAAW;AACfA,gCAAG,MAAC,MAAM,OAAM,6EAA4E,SAASC,IAAG;AACxGD,gCAAAA,MAAI,UAAU;AAAA,oBACZ,OAAO;AAAA,oBACP,MAAM;AAAA,kBACP,CAAA;AACD,uBAAK,WAAW;AAAA,gBACjB;AAAA,gBACD,MAAM,CAAC,QAAG;AACRA,gCAAG,MAAC,YAAW;AACf,sBAAI,SAAS,IAAI;AACjB,sBAAI,UAAU,uCAAuC;AACnD,6BAAS;AAAA,kBACX;AACAA,gCAAAA,MAAI,UAAU;AAAA,oBACZ,OAAO;AAAA,oBACP,MAAM;AAAA,kBACP,CAAA;AACDA,gCAAG,MAAC,MAAM,SAAQ,6EAA4E,QAAQ,GAAG;AAAA,gBAC3G;AAAA,cACD,CAAA;AAAA,YACD,OAAK;AACLA,4BAAG,MAAC,YAAW;AACf,kBAAI,KAAK,QAAQ,KAAK,MAAM;AAC1BA,oCAAI,UAAU,IAAA,cAAA;AAAA,kBACZ,OAAO;AAAA,kBACP,SAAS,KAAK,QAAQ;AAAA,kBACtB,YAAY;AAAA,gBACb,CAAA,CAAA;AAAA,cACH;AACA,qBAAM;AAAA,YACR;AAAA,UACD;AAAA,UACD,MAAM,CAAC,QAAG;AACRA,0BAAG,MAAC,MAAM,SAAQ,6EAA4E,eAAe,GAAG;AAChHA,0BAAG,MAAC,YAAW;AAAA,UACjB;AAAA,QACD,CAAA;AAAA,MACD,SAAO,KAAK;AACZA,sBAAG,MAAC,MAAM,SAAQ,6EAA4E,SAAS,GAAG;AAC1GA,sBAAAA,MAAI,UAAU;AAAA,UACZ,OAAO;AAAA,UACP,MAAM;AAAA,QACP,CAAA;AACDA,sBAAG,MAAC,YAAW;AAAA,MACjB;AAAA,IACD;AAAA,IACD,cAAW;AACMA,oBAAAA,MAAI,eAAgB;AACnC,UAAI;AAQJ,iBAAWA,cAAAA,MAAI,qBAAqB,YAAY;AAEhD,aAAO;AAAA,IACR;AAAA,IAED,YAAS;AACPA,oBAAAA,MAAI,YAAY;AAAA,QACd,OAAO;AAAA,QACP,MAAM;AAAA,MACP,CAAA;AACD,UAAI,WAAW,KAAK;AACpBA,0BAAI,MAAM,IAAA,cAAA;AAAA,QACR,UAAU;AAAA,QACV,SAAS,CAAC,QAAG;AACXA,wBAAAA,MAAI,QAAQ;AAAA,YACV,KAAK;AAAA,YACL,QAAQ;AAAA,YACR,MAAM,IAAA,cAAA;AAAA,cACJ,MAAM,IAAI;AAAA,cACV;AAAA,aACD;AAAA,YACD,SAAS,CAACC,SAAG;AACXD,4BAAG,MAAC,YAAW;AACf,mBAAK,SAASC,KAAI,KAAK;AACvBD,4BAAG,MAAC,MAAM,OAAM,6EAA4E,YAAY,KAAK,MAAM;AAAA,YACpH;AAAA,YACD,MAAM,CAAC,QAAG;AACRA,4BAAG,MAAC,YAAW;AACfA,4BAAG,MAAC,MAAM,SAAQ,6EAA4E,eAAe,GAAG;AAAA,YAClH;AAAA,UACD,CAAA;AAAA,QACH;AAAA,MACD,CAAA,CAAA;AAAA,IACF;AAAA,EAEH;CACF;;;;;;;;;;;;ACjOF,GAAG,WAAW,eAAe;"}
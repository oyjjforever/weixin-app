{"version":3,"file":"requestTask.js","sources":["pages/API/request/requestTask.uvue","../../../Program Files/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvQVBJL3JlcXVlc3QvcmVxdWVzdFRhc2sudXZ1ZQ"],"sourcesContent":["<template>\r\n  <view style=\"flex: 1;\">\r\n    <view class=\"uni-padding-wrap uni-common-mt\">\r\n      <view class=\"uni-common-mt\" style=\"border-width: 2px;border-style: solid; border-radius: 4px;\">\r\n        <textarea :value=\"res\" class=\"uni-textarea\" style=\"width: 100%\"></textarea>\r\n      </view>\r\n      <view>\r\n        <text>地址 : {{ host + url}}</text>\r\n        <text>请求方式 : {{method}}</text>\r\n      </view>\r\n      <view class=\"uni-btn-v uni-common-mt\">\r\n        <button type=\"primary\" @tap=\"checkRequestTask\" id=\"checkRequestTask\">发起流式请求（设置监听需重新点击、勿重复点击）</button>\r\n        <view class=\"uni-common-pb\"></view>\r\n        <button type=\"primary\" @tap=\"abort\" id=\"abort\">中断流式请求</button>\r\n      </view>\r\n    </view>\r\n    <scroll-view style=\"flex: 1;\" show-scrollbar=\"true\">\r\n      <view style=\"padding: 20px;\">\r\n        <text>添加或者移除流式监听</text>\r\n        <view class=\"uni-common-pb\"></view>\r\n        <view style=\"flex-direction: row;flex-wrap: wrap;\">\r\n          <button style=\"padding: 5px;\" type=\"primary\" size=\"mini\" @tap=\"onHeadersReceived_observe_1\"\r\n            id=\"onHeadersReceived_observe_1\">onHeadersReceived监听1</button>\r\n          <button style=\"padding: 5px;\" type=\"primary\" size=\"mini\" @tap=\"onHeadersReceived_observe_2\"\r\n            id=\"onHeadersReceived_observe_2\">onHeadersReceived监听2</button>\r\n          <button style=\"padding: 5px;\" type=\"primary\" size=\"mini\" @tap=\"onChunkReceived_observe_1\"\r\n            id=\"onChunkReceived_observe_1\">onChunkReceived监听1</button>\r\n          <button style=\"padding: 5px;\" type=\"primary\" size=\"mini\" @tap=\"onChunkReceived_observe_2\"\r\n            id=\"onChunkReceived_observe_2\">onChunkReceived监听2</button>\r\n          <button style=\"padding: 5px;\" type=\"primary\" size=\"mini\" @tap=\"offHeadersReceived_id\"\r\n            id=\"offHeadersReceived_id\">offHeadersReceived(id)</button>\r\n          <button style=\"padding: 5px;\" type=\"primary\" size=\"mini\" @tap=\"offHeadersReceived_observe\"\r\n            id=\"offHeadersReceived_observe\">offHeadersReceived移除所有</button>\r\n          <button style=\"padding: 5px;\" type=\"primary\" size=\"mini\" @tap=\"offChunkReceived_observe\"\r\n            id=\"offChunkReceived_observe\">offChunkReceived移除所有</button>\r\n        </view>\r\n      </view>\r\n    </scroll-view>\r\n  </view>\r\n</template>\r\n<script lang=\"uts\">\r\n  export default {\r\n    data() {\r\n      return {\r\n        res: '',\r\n        task: null as RequestTask | null,\r\n        host: \"https://request.dcloud.net.cn\",\r\n        url: \"/api/http/contentType/eventStream?limit=10\",\r\n        method: \"POST\" as RequestMethod,\r\n        data: null as any | null,\r\n        onHeadersReceivedObseves: [] as number[],\r\n        onChunkReceivedObseves: [] as number[],\r\n        onHeadersReceived_returnid_1: -1,\r\n        onHeadersReceived_returnid_2: -1,\r\n        isAbort: false,\r\n      }\r\n    },\r\n    onLoad() {\r\n      this.onHeadersReceivedObseves.push(1)\r\n      this.onChunkReceivedObseves.push(1)\r\n    },\r\n    onUnload() {\r\n      uni.hideLoading();\r\n      this.task?.abort();\r\n    },\r\n    methods: {\r\n      onHeadersReceived_observe_1: function () {\r\n        this.onHeadersReceivedObseves.push(1)\r\n      },\r\n      onHeadersReceived_observe_2: function () {\r\n        this.onHeadersReceivedObseves.push(2)\r\n      },\r\n      offHeadersReceived_observe: function () {\r\n        this.onHeadersReceivedObseves = []\r\n      },\r\n      offHeadersReceived_id: function () {\r\n        this.onHeadersReceivedObseves = []\r\n        this.onHeadersReceivedObseves.push(1)\r\n      },\r\n      onChunkReceived_observe_1: function () {\r\n        this.onChunkReceivedObseves.push(1)\r\n      },\r\n      onChunkReceived_observe_2: function () {\r\n        this.onChunkReceivedObseves.push(2)\r\n      },\r\n      offChunkReceived_observe: function () {\r\n        this.onChunkReceivedObseves = []\r\n      },\r\n      checkRequestTask: function () {\r\n        this.isAbort = false\r\n        this.res = '发起post流式请求 \\n\\n'\r\n        this.task = uni.request({\r\n          url: \"https://request.dcloud.net.cn/api/http/contentType/eventStream?limit=10\",\r\n          timeout: 600000,\r\n          method: this.method,\r\n          enableChunked: true,\r\n          success: (res) => {\r\n            uni.__f__('log','at pages/API/request/requestTask.uvue:98','request success', JSON.stringify(res.data))\r\n            uni.__f__('log','at pages/API/request/requestTask.uvue:99','request success header is :', JSON.stringify(res.header))\r\n            uni.showToast({\r\n              title: '流式请求结束',\r\n              icon: 'success',\r\n              mask: true\r\n            });\r\n            uni.__f__('log','at pages/API/request/requestTask.uvue:105','请求结果 : ' + JSON.stringify(res))\r\n          },\r\n          fail: (err) => {\r\n            let content = err.errMsg\r\n            if (this.isAbort) {\r\n              content = \"中断成功\"\r\n            }\r\n            uni.__f__('log','at pages/API/request/requestTask.uvue:112','request fail', err);\r\n            uni.showModal({\r\n              content: content,\r\n              showCancel: false\r\n            });\r\n          },\r\n          complete: () => {\r\n            this.task = null\r\n          },\r\n        });\r\n\r\n        const onHeadersReceivedCallback1 = (res : RequestTaskOnHeadersReceivedListenerResult) => {\r\n          uni.__f__('log','at pages/API/request/requestTask.uvue:124',\"-------onHeadersReceived监听1------\", res)\r\n          this.res += `onHeadersReceived监听1：\\n ${JSON.stringify(res)} \\n\\n`\r\n        }\r\n        const onHeadersReceivedCallback2 = (res : RequestTaskOnHeadersReceivedListenerResult) => {\r\n          uni.__f__('log','at pages/API/request/requestTask.uvue:128',\"-------onHeadersReceived监听2------\", res)\r\n          this.res += `onHeadersReceived监听2：\\n ${JSON.stringify(res)}  \\n\\n`\r\n        }\r\n\r\n        if (this.onHeadersReceivedObseves.includes(1)) {\r\n          this.onHeadersReceived_returnid_1 = this.task?.onHeadersReceived(onHeadersReceivedCallback1) ?? -1\r\n        }\r\n\r\n        if (this.onHeadersReceivedObseves.length == 0) {\r\n          this.task?.offHeadersReceived(null)\r\n          this.res += \"点击了 offHeadersReceived \\n\\n\"\r\n        } else if (this.onHeadersReceivedObseves.length == 1) {\r\n          this.task?.offHeadersReceived(this.onHeadersReceived_returnid_2)\r\n        }\r\n\r\n        const onChunkReceivedCallback1 = (res : RequestTaskOnChunkReceivedListenerResult) => {\r\n          const chunkText : string = new TextDecoder().decode(res.data)\r\n          uni.__f__('log','at pages/API/request/requestTask.uvue:145',\"-------onChunkReceived监听1------\", chunkText)\r\n          this.res += `onChunkReceived监听1：\\n ${chunkText}`\r\n        }\r\n        const onChunkReceivedCallback2 = (res : RequestTaskOnChunkReceivedListenerResult) => {\r\n          const chunkText : string = new TextDecoder().decode(res.data)\r\n          uni.__f__('log','at pages/API/request/requestTask.uvue:150',\"-------onChunkReceived监听2------\", chunkText)\r\n          this.res += `onChunkReceived监听2：\\n ${chunkText}`\r\n        }\r\n\r\n        if (this.onHeadersReceivedObseves.includes(2)) {\r\n          this.onHeadersReceived_returnid_2 = this.task?.onHeadersReceived(onHeadersReceivedCallback2) ?? -1\r\n        }\r\n\r\n        if (this.onChunkReceivedObseves.includes(1)) {\r\n          this.task?.onChunkReceived(onChunkReceivedCallback1)\r\n        }\r\n\r\n        if (this.onChunkReceivedObseves.includes(2)) {\r\n          this.task?.onChunkReceived(onChunkReceivedCallback2)\r\n        }\r\n\r\n        if (this.onChunkReceivedObseves.length == 0) {\r\n          this.task?.offChunkReceived(null)\r\n          this.res += \"点击了 offChunkReceived \\n\\n\"\r\n        }\r\n      },\r\n      abort() {\r\n        this.isAbort = true\r\n        this.task?.abort()\r\n      }\r\n\r\n    }\r\n  }\r\n</script>\r\n\r\n<style>\r\n  .uni-textarea {\r\n    padding: 9px;\r\n    font-size: 14px;\r\n  }\r\n</style>\n","import MiniProgramPage from 'W:/Workplace/2.小程序/lihai-app/pages/API/request/requestTask.uvue'\nwx.createPage(MiniProgramPage)"],"names":["defineComponent","uni"],"mappings":"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"}
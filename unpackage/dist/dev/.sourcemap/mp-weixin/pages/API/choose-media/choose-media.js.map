{"version":3,"file":"choose-media.js","sources":["pages/API/choose-media/choose-media.uvue","../../../Program Files/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvQVBJL2Nob29zZS1tZWRpYS9jaG9vc2UtbWVkaWEudXZ1ZQ"],"sourcesContent":["<template>\r\n\r\n\r\n\r\n    <view>\r\n      <page-head :title=\"title\"></page-head>\r\n      <view class=\"uni-common-mt\">\r\n        <view class=\"uni-list\">\r\n\r\n          <view class=\"uni-list-cell cell-pd\">\r\n            <view class=\"uni-list-cell-left uni-label\">\r\n              来源\r\n            </view>\r\n            <view class=\"uni-list-cell-right\" @click=\"chooseMediaSource\">\r\n              <text class=\"click-t\">{{sourceTypes[sourceTypeIndex].title}}</text>\r\n            </view>\r\n          </view>\r\n\r\n          <view class=\"uni-list-cell cell-pd\">\r\n            <view class=\"uni-list-cell-left uni-label\">\r\n              方式\r\n            </view>\r\n            <view class=\"uni-list-cell-right\" @click=\"chooseMediaType\">\r\n              <text class=\"click-t\">{{(mediaTypes[mediaTypeIndex] as ChooseSource).title}}</text>\r\n            </view>\r\n          </view>\r\n\r\n          <view class=\"uni-list-cell cell-pd\">\r\n            <view class=\"uni-list-cell-left uni-label\">\r\n              数量限制\r\n            </view>\r\n            <view class=\"uni-list-cell-right\">\r\n              <input class=\"click-t\" ref=\"refCountInput\" :value=\"count\" type=\"number\" :maxlength=\"1\" @blur=\"chooseMediaCount\"/>\r\n            </view>\r\n          </view>\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n          <view class=\"uni-list-cell cell-pd\">\r\n            <view class=\"uni-list-cell-left uni-label\">\r\n              摄像头\r\n            </view>\r\n            <view class=\"uni-list-cell-right\" @click=\"chooseCameraType\">\r\n              <text class=\"click-t\">{{cameraTypes[cameraTypeIndex].title}}</text>\r\n            </view>\r\n          </view>\r\n        </view>\r\n\r\n\r\n\r\n        <view class=\"uni-list list-pd\" style=\"padding: 15px;\">\r\n          <view class=\"uni-flex\" style=\"margin-bottom: 10px;\">\r\n            <view class=\"uni-list-cell-left\">点击预览</view>\r\n            <view style=\"margin-left: auto;\">\r\n              <text class=\"click-t\">{{mediaList.length}}/{{count}}</text>\r\n            </view>\r\n          </view>\r\n          <view class=\"uni-flex\" style=\"flex-wrap: wrap;\">\r\n            <view v-for=\"(file,index) in mediaList\" :key=\"index\" class=\"uni-uploader__input-box\" style=\"border: 0;\">\r\n              <image style=\"width: 104px; height: 104px;\" :src=\"file.imagePath\" :data-src=\"file.imagePath\" @tap=\"previewMedia(index)\">\r\n              </image>\r\n              <image src=\"/static/plus.png\" class=\"image-remove\" @click=\"removeMedia(index)\"></image>\r\n            </view>\r\n            <image class=\"uni-uploader__input-box\" @tap=\"chooseMedia\" src=\"/static/plus.png\"></image>\r\n          </view>\r\n        </view>\r\n      </view>\r\n    </view>\r\n\r\n\r\n\r\n</template>\r\n\r\n<script lang=\"uts\">\r\n  type FileSource = {\r\n    imagePath : string;\r\n    filePath : string;\r\n    fileType : string;\r\n  };\r\n  type ChooseSource = {\r\n    value : string[];\r\n    title : string;\r\n  };\r\n  const sourceTypeList : ChooseSource[] = [\r\n    {\r\n      value: ['camera'],\r\n      title: '拍摄',\r\n    },\r\n    {\r\n      value: ['album'],\r\n      title: '相册',\r\n    },\r\n    {\r\n      value: ['camera', 'album'],\r\n      title: '拍摄或相册',\r\n    }\r\n  ];\r\n\r\n  const mediaTypeList : ChooseSource[] = [\r\n    {\r\n      value: ['image'],\r\n      title: '仅图片',\r\n    },\r\n    {\r\n      value: ['video'],\r\n      title: '仅视频',\r\n    },\r\n    {\r\n      value: ['image', 'video'],\r\n      title: '不限制',\r\n    }\r\n  ];\r\n\r\n  const orientationTypeList : ChooseSource[] = [\r\n    {\r\n      value: ['portrait'],\r\n      title: '竖屏',\r\n    },\r\n    {\r\n      value: ['landscape'],\r\n      title: '横屏',\r\n    },\r\n    {\r\n      value: ['auto'],\r\n      title: '自动',\r\n    }\r\n  ];\r\n  const cameraTypeList : ChooseSource[] = [\r\n    {\r\n      value: ['front'],\r\n      title: '前置摄像头',\r\n    },\r\n    {\r\n      value: ['back'],\r\n      title: '后置摄像头',\r\n    }\r\n  ];\r\n  export default {\r\n    data() {\r\n      return {\r\n        title: 'chooseMedia',\r\n        mediaList: [] as Array<FileSource>,\r\n        sourceTypeIndex: 2,\r\n        mediaTypeIndex: 2,\r\n        cameraTypeIndex: 1,\r\n        orientationTypeIndex: 0,\r\n        albumModeTypeIndex: 0,\r\n        count: 9,\r\n        maxDuration: 10,\r\n        sourceTypes: sourceTypeList as ChooseSource[],\r\n        mediaTypes: mediaTypeList as ChooseSource[],\r\n        cameraTypes: cameraTypeList as ChooseSource[],\r\n        orientationTypes: orientationTypeList as ChooseSource[]\r\n      }\r\n    },\r\n    methods: {\r\n      chooseMediaSource() {\r\n        uni.showActionSheet({\r\n          itemList: ['拍摄', '相册', '拍摄或相册'],\r\n          success: (e) => {\r\n            this.sourceTypeIndex = e.tapIndex\r\n          }\r\n        })\r\n      },\r\n      chooseMediaType() {\r\n        uni.showActionSheet({\r\n          itemList: ['仅图片', '仅视频', '不限制'],\r\n          success: (e) => {\r\n            this.mediaTypeIndex = e.tapIndex\r\n          }\r\n        })\r\n      },\r\n      chooseMediaCount(event : UniInputBlurEvent) {\r\n        let count = parseInt(event.detail.value)\r\n        if (count < 1 || count > 9 || isNaN(count)) {\r\n          uni.showToast({\r\n            position: \"bottom\",\r\n            title: \"图片数量应该不小于1不大于9\"\r\n          })\r\n          return\r\n        }\r\n        this.count = count\r\n      },\r\n      chooseOrientationType() {\r\n        uni.showActionSheet({\r\n          itemList: ['竖屏', '横屏', '自动'],\r\n          success: (e) => {\r\n            this.orientationTypeIndex = e.tapIndex\r\n          }\r\n        })\r\n      },\r\n      chooseCameraType() {\r\n        uni.showActionSheet({\r\n          itemList: ['前置', '后置'],\r\n          success: (e) => {\r\n            this.cameraTypeIndex = e.tapIndex\r\n          }\r\n        })\r\n      },\r\n      onMaxDurationConfirm(value : number) {\r\n        this.maxDuration = value;\r\n      },\r\n      chooseMedia() {\r\n        if (this.mediaList.length >= this.count) {\r\n          const message = \"已经有\" + this.count + \"个了，请删除部分后重新选择\";\r\n          uni.showToast({\r\n            position: \"bottom\",\r\n            title: message\r\n          })\r\n          return\r\n        }\r\n\r\n        uni.chooseMedia({\r\n          count: this.count - this.mediaList.length,\r\n          sourceType: sourceTypeList[this.sourceTypeIndex].value,\r\n          mediaType: mediaTypeList[this.mediaTypeIndex].value,\r\n          camera: cameraTypeList[this.cameraTypeIndex].value[0],\r\n\r\n\r\n\r\n\r\n\r\n\r\n          success: (res) => {\r\n            const tempFiles : ChooseMediaTempFile[] = res.tempFiles as ChooseMediaTempFile[];\r\n            for (let i = 0; i < tempFiles.length; i++) {\r\n              const tempFile : ChooseMediaTempFile = tempFiles[i]\r\n              const imagePath = tempFile.fileType == \"image\" ? tempFile.tempFilePath : tempFile.thumbTempFilePath;\r\n              const file : FileSource = { imagePath: imagePath!, filePath: tempFile.tempFilePath, fileType: tempFile.fileType };\r\n              this.mediaList.push(file);\r\n            }\r\n          },\r\n          fail: (err) => {\r\n            uni.__f__('log','at pages/API/choose-media/choose-media.uvue:243',\"err: \", JSON.stringify(err));\r\n            uni.showToast({\r\n              title:\"choose media error.code:\" + err.errCode+\";message:\"+err.errMsg,\r\n              position:\"bottom\"\r\n            })\r\n          }\r\n        })\r\n      },\r\n      previewMedia: function (index : number) {\r\n        const file : FileSource = this.mediaList[index];\r\n        if (file.fileType == \"image\") {\r\n          uni.previewImage({\r\n            current: 0,\r\n            urls: [file.filePath]\r\n          })\r\n        } else {\r\n          uni.$once(\"__ONFULLVIDEOLOAD\", () => {\r\n            uni.$emit(\"__ONRECEIVEURL\", {\r\n              \"url\": file.filePath,\r\n              \"cover\": file.imagePath\r\n            })\r\n          })\r\n          const url = \"/pages/API/choose-media/fullscreen-video\";\r\n          uni.navigateTo({\r\n            url: url,\r\n          })\r\n        }\r\n\r\n      },\r\n      removeMedia(index : number) {\r\n        this.mediaList.splice(index, 1)\r\n      },\r\n    }\r\n  }\r\n</script>\r\n\r\n<style>\r\n  .cell-pd {\r\n    padding: 11px 15px;\r\n  }\r\n\r\n  .click-t {\r\n    color: darkgray;\r\n  }\r\n\r\n  .list-pd {\r\n    margin-top: 25px;\r\n  }\r\n\r\n  .uni-uploader__input-box {\r\n    margin: 5px;\r\n    width: 104px;\r\n    height: 104px;\r\n    border: 1px solid #D9D9D9;\r\n  }\r\n\r\n  .uni-uploader__input {\r\n    position: absolute;\r\n    z-index: 1;\r\n    top: 0;\r\n    left: 0;\r\n    width: 100%;\r\n    height: 100%;\r\n    opacity: 0;\r\n  }\r\n\r\n  .image-remove {\r\n    transform: rotate(45deg);\r\n    width: 25px;\r\n    height: 25px;\r\n    position: absolute;\r\n    top: 0;\r\n    right: 0;\r\n    border-radius: 13px;\r\n    background-color: rgba(200, 200, 200, 0.8);\r\n  }\r\n\r\n  .item_width {\r\n    width: 130px;\r\n  }\r\n</style>\r\n","import MiniProgramPage from 'W:/Workplace/2.小程序/lihai-app/pages/API/choose-media/choose-media.uvue'\nwx.createPage(MiniProgramPage)"],"names":["defineComponent","uni"],"mappings":"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"}
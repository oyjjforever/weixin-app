{"version":3,"file":"upload-file.js","sources":["pages/API/upload-file/upload-file.uvue","../../../Program Files/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvQVBJL3VwbG9hZC1maWxlL3VwbG9hZC1maWxlLnV2dWU"],"sourcesContent":["<template>\r\n\r\n\r\n\r\n    <view>\r\n      <page-head :title=\"title\"></page-head>\r\n      <view class=\"uni-padding-wrap uni-common-mt\">\r\n        <view class=\"demo\">\r\n          <image v-if=\"imageSrc\" :src=\"imageSrc\" class=\"image\" mode=\"widthFix\"></image>\r\n          <text v-else class=\"uni-hello-addfile\" @click=\"chooseImage\">+ 选择图片</text>\r\n        </view>\r\n      </view>\r\n    </view>\r\n\r\n\r\n\r\n</template>\r\n<script lang=\"uts\">\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n  export default {\r\n    data() {\r\n      return {\r\n        title: 'uploadFile',\r\n        imageSrc: '',\r\n        task: null as UploadTask | null,\r\n        //自动化测试例专用\r\n        jest_result: false,\r\n      }\r\n    },\r\n    onLoad() {\r\n    },\r\n    onUnload() {\r\n      this.imageSrc = '';\r\n      uni.hideLoading();\r\n      this.task?.abort();\r\n    },\r\n    methods: {\r\n      chooseImage: function () {\r\n        uni.chooseImage({\r\n          count: 1,\r\n          sizeType: ['compressed'],\r\n          sourceType: ['album'],\r\n          success: (res) => {\r\n            uni.__f__('log','at pages/API/upload-file/upload-file.uvue:50','chooseImage success, temp path is', res.tempFilePaths[0])\r\n            var imageSrc = res.tempFilePaths[0]\r\n            uni.showLoading({\r\n              title: '上传中'\r\n            })\r\n            this.task = uni.uploadFile({\r\n              url: 'https://unidemo.dcloud.net.cn/upload', //仅为示例，非真实的接口地址\r\n              filePath: imageSrc,\r\n              name: 'file',\r\n              formData: {\r\n                'user': 'test'\r\n              },\r\n              success: (res) => {\r\n                uni.__f__('log','at pages/API/upload-file/upload-file.uvue:63','uploadImage success, res is:', res)\r\n                uni.showToast({\r\n                  title: '上传成功',\r\n                  icon: 'success',\r\n                  duration: 1000\r\n                })\r\n                this.imageSrc = imageSrc\r\n              },\r\n              fail: (err) => {\r\n                uni.__f__('log','at pages/API/upload-file/upload-file.uvue:72','uploadImage fail', err);\r\n                uni.showModal({\r\n                  content: err.errMsg,\r\n                  showCancel: false\r\n                });\r\n              },\r\n              complete: (res) => {\r\n                uni.hideLoading();\r\n                this.task = null\r\n              }\r\n            });\r\n          },\r\n          fail: (err) => {\r\n            uni.__f__('log','at pages/API/upload-file/upload-file.uvue:85','chooseImage fail', err)\r\n          }\r\n        })\r\n      },\r\n      //自动化测试例专用\r\n      jest_uploadFile() {\r\n        const imageSrc = \"/static/uni.png\";\r\n        uni.uploadFile({\r\n          url: 'https://unidemo.dcloud.net.cn/upload', //仅为示例，非真实的接口地址\r\n          filePath: imageSrc,\r\n          name: 'file',\r\n          formData: {\r\n            'user': 'test'\r\n          },\r\n          success: () => {\r\n            this.jest_result = true;\r\n          },\r\n          fail: () => {\r\n            this.jest_result = false;\r\n          },\r\n        })\r\n      },\r\n      jest_uploadFile_with_uni_env() {\r\n        /**\r\n         * 微信小程序只支持USER_DATA_PATH，且子目录未创建的情况下不能直接下载到子目录内\r\n         */\r\n        const filePath = `${uni.env.USER_DATA_PATH}/uni-app.png`\r\n        uni.downloadFile({\r\n          url: \"https://qiniu-web-assets.dcloud.net.cn/unidoc/zh/uni-app.png\",\r\n          filePath: filePath,\r\n          success: () => {\r\n            uni.uploadFile({\r\n              url: 'https://unidemo.dcloud.net.cn/upload', //仅为示例，非真实的接口地址\r\n              filePath: filePath,\r\n              name: 'file',\r\n              success: () => {\r\n                this.jest_result = true;\r\n              },\r\n              fail: () => {\r\n                this.jest_result = false;\r\n              },\r\n            })\r\n          },\r\n          fail: () => {\r\n            this.jest_result = false\r\n          }\r\n        });\r\n      },\r\n      jest_set_cookie() {\r\n        uni.request({\r\n          url: \"https://request.dcloud.net.cn/api/http/header/setCookie\",\r\n          method: \"GET\",\r\n          timeout: 6000,\r\n          sslVerify: false,\r\n          withCredentials: false,\r\n          firstIpv4: false,\r\n          success: () => {\r\n            this.jest_cookie_upload(true)\r\n          },\r\n          fail: () => {\r\n            this.jest_result = false;\r\n          },\r\n        });\r\n      },\r\n\r\n      jest_delete_cookie() {\r\n        uni.request({\r\n          url: \"https://request.dcloud.net.cn/api/http/header/deleteCookie\",\r\n          method: \"GET\",\r\n          timeout: 6000,\r\n          sslVerify: false,\r\n          withCredentials: false,\r\n          firstIpv4: false,\r\n          success: () => {\r\n            this.jest_cookie_upload(false)\r\n          },\r\n          fail: () => {\r\n            this.jest_result = false;\r\n          },\r\n        });\r\n      },\r\n      jest_cookie_upload(needCookie : boolean) {\r\n        const imageSrc = \"/static/uni.png\";\r\n        uni.uploadFile({\r\n          url: 'https://request.dcloud.net.cn/api/http/header/upload',\r\n          filePath: imageSrc,\r\n          name: 'file',\r\n          success: (res : UploadFileSuccess) => {\r\n            const data = JSON.parseObject(res.data)\r\n            const errCode = data?.getNumber(\"errCode\")\r\n            if (errCode != null && errCode == 1000) {\r\n              this.jest_result = needCookie ? false : true;\r\n            } else {\r\n              this.jest_result = needCookie ? true : false;\r\n            }\r\n          },\r\n          fail: () => {\r\n            this.jest_result = false;\r\n          },\r\n        })\r\n      },\r\n      jest_files_upload() {\r\n        const imageSrc = \"/static/uni.png\";\r\n        uni.uploadFile({\r\n          url: 'https://unidemo.dcloud.net.cn/upload',\r\n          files: [\r\n            {\r\n              name: \"file1\",\r\n              uri: imageSrc\r\n            } as UploadFileOptionFiles,\r\n            {\r\n              name: \"file2\",\r\n              uri: imageSrc\r\n            } as UploadFileOptionFiles\r\n          ],\r\n          success: (res : UploadFileSuccess) => {\r\n            if (res.statusCode == 200) {\r\n              this.jest_result = true;\r\n            }\r\n          },\r\n          fail: () => {\r\n            this.jest_result = false;\r\n          },\r\n        })\r\n      },\r\n      jest_uts_module_invoked() {\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n      }\r\n    }\r\n  }\r\n</script>\r\n\r\n<style>\r\n  .image {\r\n    width: 100%;\r\n  }\r\n\r\n  .demo {\r\n    background: #fff;\r\n    padding: 25px;\r\n    justify-content: center;\r\n    align-items: center;\r\n  }\r\n\r\n  .uni-hello-addfile {\r\n    text-align: center;\r\n    background: #fff;\r\n    padding: 25px;\r\n    margin-top: 10px;\r\n    font-size: 19px;\r\n    color: #808080;\r\n  }\r\n</style>\r\n","import MiniProgramPage from 'W:/Workplace/2.小程序/lihai-app/pages/API/upload-file/upload-file.uvue'\nwx.createPage(MiniProgramPage)"],"names":["defineComponent","uni","res"],"mappings":"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"}
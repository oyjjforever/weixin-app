{"version":3,"file":"download-file.js","sources":["pages/API/download-file/download-file.uvue","../../../Program Files/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvQVBJL2Rvd25sb2FkLWZpbGUvZG93bmxvYWQtZmlsZS51dnVl"],"sourcesContent":["<template>\r\n\r\n\r\n\r\n    <view>\r\n      <page-head :title=\"title\"></page-head>\r\n      <view>\r\n        <view v-if=\"imageSrc\">\r\n          <image class=\"img\" :src=\"imageSrc\" mode=\"aspectFit\" />\r\n        </view>\r\n        <view v-else style=\"margin: 10px;\">\r\n          <text class=\"uni-hello-text\">点击按钮下载服务端示例图片（下载网络文件到本地临时目录）</text>\r\n          <button type=\"primary\" @tap=\"downloadImage\">下载</button>\r\n        </view>\r\n        <view style=\"margin: 10px;\">\r\n          <text class=\"uni-hello-text\">下载接口的Content-Disposition中的filename非法值例子</text>\r\n          <button type=\"primary\" @tap=\"downloadErrorFilename\">下载</button>\r\n        </view>\r\n      </view>\r\n    </view>\r\n\r\n\r\n\r\n</template>\r\n<script lang=\"uts\">\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n  export default {\r\n    data() {\r\n      return {\r\n        title: 'downloadFile',\r\n        imageSrc: '',\r\n        task: null as DownloadTask | null,\r\n        //自动化测试例专用\r\n        jest_result: false,\r\n        jest_callback_triggred: false\r\n      }\r\n    },\r\n    onLoad() {\r\n    },\r\n    onUnload() {\r\n      // this.imageSrc = '';\r\n      uni.hideLoading();\r\n      this.task?.abort();\r\n    },\r\n    methods: {\r\n      downloadImage: function () {\r\n        uni.showLoading({\r\n          title: '下载中'\r\n        })\r\n        var self = this\r\n        this.task = uni.downloadFile({\r\n          url: \"https://qiniu-web-assets.dcloud.net.cn/unidoc/zh/uni-app.png\",\r\n          success: (res) => {\r\n            uni.__f__('log','at pages/API/download-file/download-file.uvue:60','downloadFile success, res is', res.tempFilePath)\r\n            self.imageSrc = res.tempFilePath;\r\n          },\r\n          fail: (err) => {\r\n            uni.__f__('log','at pages/API/download-file/download-file.uvue:64','downloadFile fail, err is:', err)\r\n          },\r\n          complete: (res) => {\r\n            uni.hideLoading();\r\n            this.task = null;\r\n          }\r\n        });\r\n        this.task?.onProgressUpdate((update) => {\r\n          uni.__f__('log','at pages/API/download-file/download-file.uvue:72',\"progress : \", update.progress);\r\n        })\r\n      },\r\n      downloadErrorFilename(){\r\n        uni.downloadFile({\r\n          url:\"https://qiniu-web-assets.dcloud.net.cn/uni-app-x/static/file/test9.txt\",\r\n          success: (res) => {\r\n            uni.__f__('log','at pages/API/download-file/download-file.uvue:79','downloadFile success, res is', res.tempFilePath)\r\n          },\r\n          fail: (err) => {\r\n            uni.__f__('log','at pages/API/download-file/download-file.uvue:82','downloadFile fail, err is:', err)\r\n          }\r\n        })\r\n      },\r\n      //自动化测试例专用\r\n      jest_downloadFile() {\r\n        uni.downloadFile({\r\n          url: \"https://qiniu-web-assets.dcloud.net.cn/unidoc/zh/uni-app.png\",\r\n          success: () => {\r\n            this.jest_result = true\r\n            this.jest_callback_triggred = true\r\n          },\r\n          fail: () => {\r\n            this.jest_result = false\r\n            this.jest_callback_triggred = true\r\n          }\r\n        });\r\n      },\r\n\r\n      jest_downloadFile_with_uni_env() {\r\n        uni.downloadFile({\r\n          url: \"https://qiniu-web-assets.dcloud.net.cn/unidoc/zh/uni-app.png\",\r\n          filePath: `${uni.env.CACHE_PATH}/a/b/`,\r\n          success: () => {\r\n            this.jest_result = true\r\n            this.jest_callback_triggred = true\r\n          },\r\n          fail: () => {\r\n            this.jest_result = false\r\n            this.jest_callback_triggred = true\r\n          }\r\n        });\r\n      },\r\n\r\n      jest_set_cookie() {\r\n        uni.request({\r\n          url: \"https://request.dcloud.net.cn/api/http/header/setCookie\",\r\n          method: \"GET\",\r\n          timeout: 6000,\r\n          sslVerify: false,\r\n          withCredentials: true,\r\n          firstIpv4: false,\r\n          success: () => {\r\n            this.jest_cookie_download(true)\r\n          },\r\n          fail: () => {\r\n            this.jest_result = false;\r\n            this.jest_callback_triggred = true\r\n          },\r\n        });\r\n      },\r\n\r\n      jest_delete_cookie() {\r\n        uni.request({\r\n          url: \"https://request.dcloud.net.cn/api/http/header/deleteCookie\",\r\n          method: \"GET\",\r\n          timeout: 6000,\r\n          sslVerify: false,\r\n          withCredentials: true,\r\n          firstIpv4: false,\r\n          success: () => {\r\n            this.jest_cookie_download(false)\r\n          },\r\n          fail: () => {\r\n            this.jest_result = false;\r\n            this.jest_callback_triggred = true\r\n          },\r\n        });\r\n      },\r\n      jest_cookie_download(needCookie : boolean) {\r\n        uni.downloadFile({\r\n          url: \"https://request.dcloud.net.cn/api/http/header/download\",\r\n          success: () => {\r\n            this.jest_result = needCookie ? true : false;\r\n            this.jest_callback_triggred = true\r\n          },\r\n          fail: () => {\r\n            this.jest_result = needCookie ? false : true;\r\n          }\r\n        });\r\n      },\r\n      jest_uts_module_invoked() {\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n      },\r\n      jest_special_characters_download() {\r\n        uni.downloadFile({\r\n          url: \"https://web-ext-storage.dcloud.net.cn/hello-uni-app-x/1789834995055525889-你好%23你好.png\",\r\n          success: (res : DownloadFileSuccess) => {\r\n            this.jest_result = true;\r\n            this.jest_callback_triggred = true\r\n          },\r\n          fail: () => {\r\n            this.jest_result = false;\r\n            this.jest_callback_triggred = true\r\n          }\r\n        });\r\n      },\r\n      jest_download_call_timeout() {\r\n        uni.downloadFile({\r\n          url: \"https://web-assets.dcloud.net.cn/video/sample/2minute-demo-10k.mp4\",\r\n          timeout: 3000,\r\n          fail: () => {\r\n            this.jest_result = false;\r\n          }\r\n        })\r\n        setTimeout(() => {\r\n          this.jest_result = true;\r\n        }, 4000)\r\n      }\r\n    }\r\n  }\r\n</script>\r\n\r\n<style>\r\n  .img {\r\n    margin: 0 auto;\r\n  }\r\n</style>\r\n","import MiniProgramPage from 'W:/Workplace/2.小程序/lihai-app/pages/API/download-file/download-file.uvue'\nwx.createPage(MiniProgramPage)"],"names":["defineComponent","uni"],"mappings":"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"}
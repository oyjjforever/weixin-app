{"version":3,"file":"get-background-audio-manager.js","sources":["pages/API/get-background-audio-manager/get-background-audio-manager.uvue","../../../Program Files/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvQVBJL2dldC1iYWNrZ3JvdW5kLWF1ZGlvLW1hbmFnZXIvZ2V0LWJhY2tncm91bmQtYXVkaW8tbWFuYWdlci51dnVl"],"sourcesContent":["<template>\n\t<view>\n\t\t<page-head :title=\"title\"></page-head>\n\t\t<view class=\"uni-padding-wrap\">\n\t\t\t<text>\n\t\t\t\t注意：1.离开当前页面后背景音乐将保持播放；\\n\n\t\t\t\t2. 硬退出app、调用stop api、播放结束都会清理后台控制中心和锁屏信息显示\n\t\t\t</text>\n\t\t\t<boolean-data :defaultValue=\"false\" title=\"是否循环播放\" @change=\"setLoop\"></boolean-data>\n\t\t\t<view class=\"uni-common-mt\">\n\t\t\t\t<slider ref=\"slider\" :value=\"position\" :min=\"0\" :max=\"duration\" @changing=\"onchanging\"\n\t\t\t\t\t@change=\"onchange\"></slider>\n\t\t\t</view>\n\t\t\t<view class=\"page-body-buttons\">\n\t\t\t\t<template v-if=\"playing\">\n\t\t\t\t\t<view class=\"page-body-button\" @tap=\"stop\">\n\t\t\t\t\t\t<image class=\"image\" src=\"/static/stop.png\"></image>\n\t\t\t\t\t</view>\n\t\t\t\t\t<view class=\"page-body-button\" @tap=\"pause\" style=\"margin-top: 20px;\">\n\t\t\t\t\t\t<image class=\"image\" src=\"/static/pause.png\"></image>\n\t\t\t\t\t</view>\n\t\t\t\t</template>\n\t\t\t\t<template v-if=\"!playing\">\n\t\t\t\t\t<view class=\"page-body-button\" @tap=\"play\">\n\t\t\t\t\t\t<image class=\"image\" src=\"/static/play.png\"></image>\n\t\t\t\t\t</view>\n\t\t\t\t</template>\n\t\t\t\t<view class=\"page-body-button\"></view>\n\t\t\t</view>\n\t\t</view>\n\t</view>\n</template>\n<script lang=\"uts\">\n\texport default {\n\t\tdata() {\n\t\t\treturn {\n\t\t\t\ttitle: 'backgroundAudio',\n\t\t\t\tbgAudioMannager: null as BackgroundAudioManager | null,\n\t\t\t\tdataUrl: 'https://web-ext-storage.dcloud.net.cn/uni-app/ForElise.mp3',\n\t\t\t\tplaying: false,\n\t\t\t\tplayTime: 0,\n\t\t\t\tformatedPlayTime: '00:00:00',\n\t\t\t\tcount: 100,\n\t\t\t\tisPlayEnd: false,\n\t\t\t\tduration: 100,\n\t\t\t\tcurrentTime: 0,\n\t\t\t\t_isChanging: false,\n\t\t\t\tbuffered: 0,\n\t\t\t\tisLoop: false\n\t\t\t}\n\t\t},\n\t\tcomputed: {\n\t\t\tposition() {\n\t\t\t\treturn this.isPlayEnd ? 0 : this.currentTime;\n\t\t\t},\n\t\t},\n\t\tonLoad: function () {\n\t\t\tlet bgAudioMannager = uni.getBackgroundAudioManager();\n\t\t\tbgAudioMannager.title = '致爱丽丝' + this.count;\n\t\t\tbgAudioMannager.epname = '专辑名：致爱丽丝' + this.count\n\t\t\tbgAudioMannager.singer = '歌手：暂无' + this.count;\n\t\t\tbgAudioMannager.coverImgUrl = 'https://web-assets.dcloud.net.cn/unidoc/zh/Alice.jpeg';\n\t\t\tbgAudioMannager.src = this.dataUrl;\n\t\t\tthis.currentTime = bgAudioMannager.currentTime\n\t\t\tthis.duration = bgAudioMannager.duration\n\t\t\tbgAudioMannager.onCanplay(() => {\n\t\t\t\tuni.__f__('log','at pages/API/get-background-audio-manager/get-background-audio-manager.uvue:67',\"音频进入可以播放状态事件\");\n\t\t\t\tthis.buffered = bgAudioMannager.buffered;\n\t\t\t\tthis.duration = bgAudioMannager.duration\n\t\t\t})\n\t\t\tbgAudioMannager.onPlay(() => {\n\t\t\t\tuni.__f__('log','at pages/API/get-background-audio-manager/get-background-audio-manager.uvue:72',\"开始播放\");\n\t\t\t\tthis.playing = true;\n\t\t\t})\n\t\t\tbgAudioMannager.onPause(() => {\n\t\t\t\tuni.__f__('log','at pages/API/get-background-audio-manager/get-background-audio-manager.uvue:76',\"暂停播放\");\n\t\t\t\tthis.playing = false;\n\t\t\t})\n\t\t\tbgAudioMannager.onStop(() => {\n\t\t\t\tuni.__f__('log','at pages/API/get-background-audio-manager/get-background-audio-manager.uvue:80',\"停止播放\");\n\t\t\t\tthis.playing = false;\n\t\t\t})\n\t\t\tbgAudioMannager.onEnded(() => {\n\t\t\t\tif (this.isLoop == false) {\n\t\t\t\t\tuni.__f__('log','at pages/API/get-background-audio-manager/get-background-audio-manager.uvue:85',\"播放结束\");\n\t\t\t\t\tthis.playing = false;\n\t\t\t\t\tthis.currentTime = 0;\n\t\t\t\t\tthis.isPlayEnd = true;\n\t\t\t\t\t(this.$refs[\"slider\"] as UniSliderElement).value = 0\n\t\t\t\t} else {\n\t\t\t\t\tuni.__f__('log','at pages/API/get-background-audio-manager/get-background-audio-manager.uvue:91',\"播放结束, 开始循环播放\");\n\t\t\t\t\tthis.bgAudioMannager!.src = this.dataUrl;\n\t\t\t\t\tthis.bgAudioMannager?.play()\n\t\t\t\t}\n\t\t\t})\n\t\t\tbgAudioMannager.onNext(() => {\n\t\t\t\tthis.count++\n\t\t\t\tuni.__f__('log','at pages/API/get-background-audio-manager/get-background-audio-manager.uvue:98',\"下一曲\", this.count);\n\t\t\t\tthis.bgAudioMannager?.stop()\n\t\t\t\tbgAudioMannager.title = '致爱丽丝' + this.count;\n\t\t\t\tbgAudioMannager.singer = '歌手：暂无' + this.count;\n\t\t\t\tthis.dataUrl = 'https://web-ext-storage.dcloud.net.cn/uni-app/ForElise.mp3'\n\t\t\t\tbgAudioMannager.coverImgUrl = 'https://qiniu-web-assets.dcloud.net.cn/unidoc/zh/music-a.png';\n\t\t\t\tthis.bgAudioMannager!.src = this.dataUrl;\n\t\t\t\tthis.bgAudioMannager?.play()\n\t\t\t})\n\t\t\tbgAudioMannager.onPrev(() => {\n\t\t\t\tthis.count--\n\t\t\t\tuni.__f__('log','at pages/API/get-background-audio-manager/get-background-audio-manager.uvue:109',\"上一曲\", this.count);\n\t\t\t\tthis.bgAudioMannager?.stop()\n\t\t\t\tbgAudioMannager.title = '致爱丽丝' + this.count;\n\t\t\t\tbgAudioMannager.singer = '歌手：暂无' + this.count;\n\t\t\t\tthis.dataUrl = 'https://web-ext-storage.dcloud.net.cn/uni-app/ForElise.mp3'\n\t\t\t\tbgAudioMannager.coverImgUrl = 'https://web-assets.dcloud.net.cn/unidoc/zh/Alice.jpeg';\n\t\t\t\tthis.bgAudioMannager!.src = this.dataUrl;\n\t\t\t\tthis.bgAudioMannager?.play()\n\t\t\t})\n\t\t\tbgAudioMannager.onSeeking(() => {\n\t\t\t\tuni.__f__('log','at pages/API/get-background-audio-manager/get-background-audio-manager.uvue:119','音频进行 seek 操作事件');\n\t\t\t})\n\t\t\tbgAudioMannager.onSeeked(() => {\n\t\t\t\tuni.__f__('log','at pages/API/get-background-audio-manager/get-background-audio-manager.uvue:122','音频完成 seek 操作事件');\n\t\t\t})\n\t\t\tbgAudioMannager.onWaiting(() => {\n\t\t\t\tuni.__f__('log','at pages/API/get-background-audio-manager/get-background-audio-manager.uvue:125','音频加载中事件');\n\t\t\t})\n\t\t\tbgAudioMannager.onTimeUpdate(() => {\n\t\t\t\tuni.__f__('log','at pages/API/get-background-audio-manager/get-background-audio-manager.uvue:128','onTimeUpdate', bgAudioMannager.currentTime)\n\t\t\t\tif (this._isChanging) { return; }\n\t\t\t\tthis.currentTime = this.bgAudioMannager!.currentTime;\n\t\t\t\tthis.buffered = this.bgAudioMannager!.buffered;\n\t\t\t\tuni.__f__('log','at pages/API/get-background-audio-manager/get-background-audio-manager.uvue:132','onTimeUpdateCb', this.currentTime)\n\n\n\t\t\t\t// 微信小程序安卓端过早的时机获取的buffered、duration为0，改为在此处获取\n\t\t\t\tif (this.bgAudioMannager!.duration === 0) {\n\t\t\t\t\tthis.buffered = this.bgAudioMannager!.buffered;\n\t\t\t\t\tthis.duration = this.bgAudioMannager!.duration\n\t\t\t\t}\n\n\t\t\t\tif (this.currentTime > this.buffered) {\n\t\t\t\t\tuni.__f__('log','at pages/API/get-background-audio-manager/get-background-audio-manager.uvue:142','缓冲不足');\n\t\t\t\t}\n\t\t\t})\n\t\t\tbgAudioMannager.onError((err) => {\n\t\t\t\tuni.__f__('log','at pages/API/get-background-audio-manager/get-background-audio-manager.uvue:146','播放出错err', err);\n\t\t\t})\n\t\t\tthis.bgAudioMannager = bgAudioMannager;\n\t\t\tthis.playing = !bgAudioMannager.paused\n\t\t\tuni.__f__('log','at pages/API/get-background-audio-manager/get-background-audio-manager.uvue:150','currentTime=', this.bgAudioMannager!.currentTime, this.bgAudioMannager!.currentTime == 0)\n\t\t},\n\t\tmethods: {\n\t\t\tplay: function () {\n\t\t\t\tuni.__f__('log','at pages/API/get-background-audio-manager/get-background-audio-manager.uvue:154','play')\n\t\t\t\tthis.isPlayEnd = false;\n\t\t\t\tthis.bgAudioMannager!.play()\n\t\t\t},\n\t\t\tpause: function () {\n\t\t\t\tthis.bgAudioMannager?.pause();\n\t\t\t},\n\t\t\tstop: function () {\n\t\t\t\tthis.bgAudioMannager?.stop();\n\t\t\t\tthis.playing = false\n\t\t\t},\n\t\t\tonchanging() {\n\t\t\t\tthis._isChanging = true;\n\t\t\t},\n\t\t\tonchange(e : UniSliderChangeEvent) {\n\t\t\t\tlet pos = e.detail.value;\n\t\t\t\tuni.__f__('log','at pages/API/get-background-audio-manager/get-background-audio-manager.uvue:170','pos', pos);\n\t\t\t\tthis.bgAudioMannager!.seek(pos);\n\t\t\t\tthis._isChanging = false;\n\t\t\t},\n\t\t\tsetLoop() {\n\t\t\t\tthis.isLoop = !this.isLoop;\n\t\t\t\tuni.__f__('log','at pages/API/get-background-audio-manager/get-background-audio-manager.uvue:176','当前是否设置循环播放，loop= ', this.isLoop);\n\t\t\t}\n\t\t}\n\t}\n</script>\n\n<style>\n\t.image {\n\t\twidth: 75px;\n\t\theight: 75px;\n\t}\n\n\t.page-body-text {\n\t\tpadding: 0 15px;\n\t}\n\n\t.page-body-wrapper {\n\t\tmargin-top: 0;\n\t}\n\n\t.page-body-info {\n\t\tpadding-bottom: 25px;\n\t}\n\n\t.time-big {\n\t\tfont-size: 30px;\n\t\tmargin: 10px;\n\t}\n\n\t.slider {\n\t\twidth: 315px;\n\t}\n\n\t.play-time {\n\t\twidth: 100%;\n\t\tpadding: 10px 0;\n\t\tdisplay: flex;\n\t\tjustify-content: space-between;\n\t\tbox-sizing: border-box;\n\t}\n\n\t.page-body-buttons {\n\t\tdisplay: flex;\n\t\tjustify-content: center;\n\t\tmargin-top: 50px;\n\t\tflex-direction: column;\n\t}\n\n\t.page-body-button {\n\t\tflex-direction: row;\n\t\tjustify-content: center;\n\t}\n</style>\n","import MiniProgramPage from 'W:/Workplace/2.小程序/lihai-app/pages/API/get-background-audio-manager/get-background-audio-manager.uvue'\nwx.createPage(MiniProgramPage)"],"names":["defineComponent","uni"],"mappings":"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"}
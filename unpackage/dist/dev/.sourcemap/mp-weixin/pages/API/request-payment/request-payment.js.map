{"version":3,"file":"request-payment.js","sources":["pages/API/request-payment/request-payment.uvue","../../../Program Files/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvQVBJL3JlcXVlc3QtcGF5bWVudC9yZXF1ZXN0LXBheW1lbnQudXZ1ZQ"],"sourcesContent":["<template>\r\n  <page-head title=\"发起支付\"></page-head>\r\n  <view class=\"uni-common-mt\" style=\"padding: 0 10px;\">\r\n    <text>如对当前页面的支付示例功能有任何疑问，通过电子邮件：service@dcloud.io 联系我们</text>\r\n  </view>\r\n  <template v-if=\"providerList.length > 0\">\r\n    <button style=\"margin-top: 20px;\" type=\"primary\" v-for=\"(item,index) in providerList\" :key=\"index\"\r\n      @click=\"requestPayment(item)\">{{item.name}}</button>\r\n  </template>\r\n</template>\r\n\r\n<script lang=\"uts\">\r\n  export type PayItem = { id : string, name : string, provider ?: UniProvider }\r\n  export default {\r\n    data() {\r\n      return {\r\n        btnText: \"支付宝支付\",\r\n        btnType: \"primary\",\r\n        orderInfo: \"\",\r\n        errorCode: 0,\r\n        errorMsg: \"\",\r\n        complete: false,\r\n        fail: false,\r\n        providerList: [] as PayItem[],\r\n        outTradeNo: \"\",\r\n        openid: \"\"\r\n      }\r\n    },\r\n    onLoad: function () {\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n      this.getOpenId()\r\n      this.providerList.push({\r\n        name: '微信支付',\r\n        id: 'wxpay'\r\n      } as PayItem);\r\n\r\n    },\r\n    methods: {\r\n      requestPayment(e : PayItem) {\r\n        const provider = e.id\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n        this.payMpWexin()\r\n\r\n      },\r\n      payAli(id : string) {\r\n        uni.showLoading({\r\n          title: \"请求中...\"\r\n        })\r\n        uni.request({\r\n          url: 'https://demo.dcloud.net.cn/payment/alipay/?total=0.01',\r\n          method: 'GET',\r\n          timeout: 6000,\r\n          success: (res) => {\r\n\r\n            this.orderInfo = JSON.stringify(res.data);\r\n            uni.__f__('log','at pages/API/request-payment/request-payment.uvue:115',\"====\" + this.orderInfo)\r\n            uni.hideLoading()\r\n            uni.requestPayment({\r\n              provider: id,\r\n              orderInfo: res.data as string,\r\n              fail: (res) => {\r\n                uni.__f__('log','at pages/API/request-payment/request-payment.uvue:121',JSON.stringify(res))\r\n                this.errorCode = res.errCode\r\n                uni.showToast({\r\n                  icon: 'error',\r\n                  title: 'errorCode:' + this.errorCode\r\n                });\r\n              },\r\n              success: (res) => {\r\n                uni.__f__('log','at pages/API/request-payment/request-payment.uvue:129',JSON.stringify(res))\r\n                uni.showToast({\r\n                  icon: 'success',\r\n                  title: '支付成功'\r\n                });\r\n              }\r\n            })\r\n          },\r\n          fail: (e) => {\r\n            uni.__f__('log','at pages/API/request-payment/request-payment.uvue:138',e)\r\n            uni.hideLoading()\r\n          },\r\n        });\r\n      },\r\n      payWX(id : string) {\r\n        uni.showLoading({\r\n          title: \"请求中...\"\r\n        })\r\n        let url = 'https://demo.dcloud.net.cn/payment/wxpayv3.__UNI__uniappx/?total=0.01'\r\n        const res = uni.getAppBaseInfo();\r\n        let packageName : string | null\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n        if (packageName == 'io.dcloud.hellouniappx') {//hello uniappx\r\n          url = 'https://demo.dcloud.net.cn/payment/wxpayv3.__UNI__HelloUniAppX/?total=0.01'\r\n        }\r\n        uni.request({\r\n          url: url,\r\n          method: 'GET',\r\n          timeout: 6000,\r\n          header: {\r\n            \"Content-Type\": \"application/json\"\r\n          } as UTSJSONObject,\r\n          success: (res) => {\r\n            uni.__f__('log','at pages/API/request-payment/request-payment.uvue:170',res.data)\r\n            uni.hideLoading()\r\n            uni.requestPayment({\r\n              provider: id,\r\n              orderInfo: JSON.stringify(res.data),\r\n              fail: (res) => {\r\n                uni.__f__('log','at pages/API/request-payment/request-payment.uvue:176',JSON.stringify(res))\r\n                this.errorCode = res.errCode\r\n                uni.showToast({\r\n                  duration: 5000,\r\n                  icon: 'error',\r\n                  title: 'errorCode:' + this.errorCode,\r\n                });\r\n              },\r\n              success: (res) => {\r\n                uni.__f__('log','at pages/API/request-payment/request-payment.uvue:185',JSON.stringify(res))\r\n                uni.showToast({\r\n                  duration: 5000,\r\n                  icon: 'success',\r\n                  title: '支付成功'\r\n                });\r\n              }\r\n            })\r\n          },\r\n          fail: (res) => {\r\n            uni.hideLoading()\r\n            uni.__f__('log','at pages/API/request-payment/request-payment.uvue:196',res)\r\n          },\r\n        });\r\n      },\r\n\r\n\r\n      getOpenId() {\r\n        uni.showLoading({\r\n          title: \"请稍等...\",\r\n          mask: true\r\n        });\r\n        let bundleId = uni.getAccountInfoSync().miniProgram.appId;\r\n        uni.login({\r\n          provider: 'weixin',\r\n          success: (res) => {\r\n            uni.request({\r\n              url: \"https://env-00jxt67zj8kj.dev-hz.cloudbasefunction.cn/uni-pay-api/getOpenId\",\r\n              method: \"GET\",\r\n              data: {\r\n                code: res.code,\r\n                bundleId\r\n              },\r\n              success: (res) => {\r\n                uni.hideLoading();\r\n                this.openid = res.data.openid;\r\n                uni.__f__('log','at pages/API/request-payment/request-payment.uvue:221','openid: ', this.openid);\r\n              },\r\n              fail: (err) => {\r\n                uni.hideLoading();\r\n                uni.__f__('error','at pages/API/request-payment/request-payment.uvue:225',\"request-err\", err);\r\n              }\r\n            });\r\n          }\r\n        })\r\n      },\r\n      payMpWexin() {\r\n        let bundleId = uni.getAccountInfoSync().miniProgram.appId;\r\n        let random = Math.floor(Math.random() * 9000) + 1000;\r\n        this.outTradeNo = `test${Date.now()}${random}`;\r\n        uni.__f__('log','at pages/API/request-payment/request-payment.uvue:235','outTradeNo: ', this.outTradeNo)\r\n        uni.showLoading({\r\n          title: \"请求中...\"\r\n        });\r\n        uni.request({\r\n          url: \"https://env-00jxt67zj8kj.dev-hz.cloudbasefunction.cn/uni-pay-api/getOrderInfo\",\r\n          method: \"GET\",\r\n          data: {\r\n            outTradeNo: this.outTradeNo,\r\n            bundleId,\r\n            openid: this.openid,\r\n            totalFee: 1\r\n          },\r\n          success: (res) => {\r\n            uni.hideLoading();\r\n            let data = res.data as UTSJSONObject;\r\n            let errCode = data['errCode'] as number;\r\n            if (errCode != 0) {\r\n              uni.showModal({\r\n                title: \"提示\",\r\n                content: data['errMsg'] as string,\r\n                showCancel: false\r\n              });\r\n              return;\r\n            }\r\n            let orderInfo = data[\"orderInfo\"] as string;\r\n            uni.__f__('log','at pages/API/request-payment/request-payment.uvue:261','orderInfo: ', orderInfo)\r\n            uni.requestPayment({\r\n              provider: \"wxpay\",\r\n              orderInfo: orderInfo,\r\n              ...JSON.parse(orderInfo),\r\n              success: (res) => {\r\n                uni.__f__('log','at pages/API/request-payment/request-payment.uvue:267','res: ', res)\r\n                uni.showToast({\r\n                  title: \"支付成功\",\r\n                  icon: 'success'\r\n                });\r\n              },\r\n              fail: (err) => {\r\n                uni.__f__('error','at pages/API/request-payment/request-payment.uvue:274',\"err\", err);\r\n                uni.hideLoading();\r\n                uni.showToast({\r\n                  title: \"支付失败\",\r\n                  icon: 'error'\r\n                });\r\n              }\r\n            });\r\n          },\r\n          fail: (err) => {\r\n            uni.hideLoading();\r\n            uni.__f__('error','at pages/API/request-payment/request-payment.uvue:285',\"request-err\", err);\r\n          }\r\n        });\r\n      },\r\n\r\n      //自动化测试使用\r\n      jest_pay() {\r\n        uni.requestPayment({\r\n          provider: \"alipay\",\r\n          orderInfo: this.orderInfo,\r\n          fail: (res : RequestPaymentFail) => {\r\n            this.errorCode = res.errCode\r\n            this.complete = true\r\n            this.fail = true\r\n          },\r\n          success: (res : RequestPaymentSuccess) => {\r\n            uni.__f__('log','at pages/API/request-payment/request-payment.uvue:301',JSON.stringify(res))\r\n            this.complete = true\r\n            this.fail = false\r\n          }\r\n        } as RequestPaymentOptions)\r\n      }\r\n    }\r\n  }\r\n</script>\r\n\r\n<style>\r\n\r\n</style>\r\n","import MiniProgramPage from 'W:/Workplace/2.小程序/lihai-app/pages/API/request-payment/request-payment.uvue'\nwx.createPage(MiniProgramPage)"],"names":["defineComponent","uni","res"],"mappings":"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"}